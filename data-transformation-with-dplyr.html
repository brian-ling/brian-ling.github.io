<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Data Transformation with dplyr | STAT 362 R for Data Science</title>
  <meta name="description" content="Notes for STAT 362" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Data Transformation with dplyr | STAT 362 R for Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notes for STAT 362" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Data Transformation with dplyr | STAT 362 R for Data Science" />
  
  <meta name="twitter:description" content="Notes for STAT 362" />
  

<meta name="author" content="Brian Ling" />


<meta name="date" content="2022-02-28" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="review-chapter-1-5.html"/>
<link rel="next" href="data-visualization-with-ggplot2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Syllabus</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> What is R and RStudio?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-will-you-learn-in-this-course"><i class="fa fa-check"></i><b>1.2</b> What will you learn in this course?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#r-and-r-as-a-programming-language"><i class="fa fa-check"></i><b>1.2.1</b> R and R as a programming language</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#data-wrangling"><i class="fa fa-check"></i><b>1.2.2</b> Data Wrangling</a></li>
<li class="chapter" data-level="1.2.3" data-path="introduction.html"><a href="introduction.html#data-visualization"><i class="fa fa-check"></i><b>1.2.3</b> Data Visualization</a></li>
<li class="chapter" data-level="1.2.4" data-path="introduction.html"><a href="introduction.html#statistical-inference"><i class="fa fa-check"></i><b>1.2.4</b> Statistical Inference</a></li>
<li class="chapter" data-level="1.2.5" data-path="introduction.html"><a href="introduction.html#machine-learning"><i class="fa fa-check"></i><b>1.2.5</b> Machine Learning</a></li>
<li class="chapter" data-level="1.2.6" data-path="introduction.html"><a href="introduction.html#some-numerical-methods"><i class="fa fa-check"></i><b>1.2.6</b> Some Numerical Methods</a></li>
<li class="chapter" data-level="1.2.7" data-path="introduction.html"><a href="introduction.html#lastly"><i class="fa fa-check"></i><b>1.2.7</b> Lastly</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#lets-get-started"><i class="fa fa-check"></i><b>1.3</b> Let’s Get Started</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#r-data-structures"><i class="fa fa-check"></i><b>1.4</b> R Data Structures</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#vectors"><i class="fa fa-check"></i><b>1.4.1</b> Vectors</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#factors"><i class="fa fa-check"></i><b>1.4.2</b> Factors</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction.html"><a href="introduction.html#matrix"><i class="fa fa-check"></i><b>1.4.3</b> Matrix</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction.html"><a href="introduction.html#lists"><i class="fa fa-check"></i><b>1.4.4</b> Lists</a></li>
<li class="chapter" data-level="1.4.5" data-path="introduction.html"><a href="introduction.html#data-frames"><i class="fa fa-check"></i><b>1.4.5</b> Data frames</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#operators"><i class="fa fa-check"></i><b>1.5</b> Operators</a><ul>
<li class="chapter" data-level="1.5.1" data-path="introduction.html"><a href="introduction.html#vectorized-operators"><i class="fa fa-check"></i><b>1.5.1</b> Vectorized Operators</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#built-in-functions"><i class="fa fa-check"></i><b>1.6</b> Built-in Functions</a><ul>
<li class="chapter" data-level="1.6.1" data-path="introduction.html"><a href="introduction.html#sort"><i class="fa fa-check"></i><b>1.6.1</b> <code>sort()</code></a></li>
<li class="chapter" data-level="1.6.2" data-path="introduction.html"><a href="introduction.html#seq"><i class="fa fa-check"></i><b>1.6.2</b> <code>seq()</code></a></li>
<li class="chapter" data-level="1.6.3" data-path="introduction.html"><a href="introduction.html#rep"><i class="fa fa-check"></i><b>1.6.3</b> <code>rep()</code></a></li>
<li class="chapter" data-level="1.6.4" data-path="introduction.html"><a href="introduction.html#pmax-pmin"><i class="fa fa-check"></i><b>1.6.4</b> <code>pmax</code>, <code>pmin</code></a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#some-useful-rstudio-shortcuts"><i class="fa fa-check"></i><b>1.7</b> Some Useful RStudio Shortcuts</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#exercises"><i class="fa fa-check"></i><b>1.8</b> Exercises</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#comments-to-exercises"><i class="fa fa-check"></i><b>1.9</b> Comments to Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>2</b> Probability</a><ul>
<li class="chapter" data-level="2.1" data-path="probability.html"><a href="probability.html#probability-distributions"><i class="fa fa-check"></i><b>2.1</b> Probability Distributions</a><ul>
<li class="chapter" data-level="2.1.1" data-path="probability.html"><a href="probability.html#common-distributions"><i class="fa fa-check"></i><b>2.1.1</b> Common Distributions</a></li>
<li class="chapter" data-level="2.1.2" data-path="probability.html"><a href="probability.html#exercises-1"><i class="fa fa-check"></i><b>2.1.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="probability.html"><a href="probability.html#simulation"><i class="fa fa-check"></i><b>2.2</b> Simulation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="programming-in-r.html"><a href="programming-in-r.html"><i class="fa fa-check"></i><b>3</b> Programming in R</a><ul>
<li class="chapter" data-level="3.1" data-path="programming-in-r.html"><a href="programming-in-r.html#writing-functions-in-r"><i class="fa fa-check"></i><b>3.1</b> Writing functions in R</a></li>
<li class="chapter" data-level="3.2" data-path="programming-in-r.html"><a href="programming-in-r.html#control-flow"><i class="fa fa-check"></i><b>3.2</b> Control Flow</a><ul>
<li class="chapter" data-level="3.2.1" data-path="programming-in-r.html"><a href="programming-in-r.html#for-loop"><i class="fa fa-check"></i><b>3.2.1</b> for loop</a></li>
<li class="chapter" data-level="3.2.2" data-path="programming-in-r.html"><a href="programming-in-r.html#while-loop"><i class="fa fa-check"></i><b>3.2.2</b> while loop</a></li>
<li class="chapter" data-level="3.2.3" data-path="programming-in-r.html"><a href="programming-in-r.html#if-cond"><i class="fa fa-check"></i><b>3.2.3</b> if (cond)</a></li>
<li class="chapter" data-level="3.2.4" data-path="programming-in-r.html"><a href="programming-in-r.html#if-cond-else-expr"><i class="fa fa-check"></i><b>3.2.4</b> if (cond) else expr</a></li>
<li class="chapter" data-level="3.2.5" data-path="programming-in-r.html"><a href="programming-in-r.html#if-else-ladder"><i class="fa fa-check"></i><b>3.2.5</b> If else ladder</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="programming-in-r.html"><a href="programming-in-r.html#automatically-reindent-code"><i class="fa fa-check"></i><b>3.3</b> Automatically Reindent Code</a></li>
<li class="chapter" data-level="3.4" data-path="programming-in-r.html"><a href="programming-in-r.html#speed-consideration"><i class="fa fa-check"></i><b>3.4</b> Speed Consideration</a></li>
<li class="chapter" data-level="3.5" data-path="programming-in-r.html"><a href="programming-in-r.html#another-simulation-example"><i class="fa fa-check"></i><b>3.5</b> Another Simulation Example</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html"><i class="fa fa-check"></i><b>4</b> Creating Some Basic Plots</a><ul>
<li class="chapter" data-level="4.1" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#scatter-plot"><i class="fa fa-check"></i><b>4.1</b> Scatter Plot</a></li>
<li class="chapter" data-level="4.2" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#line-graph"><i class="fa fa-check"></i><b>4.2</b> Line Graph</a></li>
<li class="chapter" data-level="4.3" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#bar-chart"><i class="fa fa-check"></i><b>4.3</b> Bar Chart</a></li>
<li class="chapter" data-level="4.4" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#histogram"><i class="fa fa-check"></i><b>4.4</b> Histogram</a></li>
<li class="chapter" data-level="4.5" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#box-plot"><i class="fa fa-check"></i><b>4.5</b> Box Plot</a></li>
<li class="chapter" data-level="4.6" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#plotting-a-function-curve"><i class="fa fa-check"></i><b>4.6</b> Plotting a function curve</a></li>
<li class="chapter" data-level="4.7" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#more-on-plots-with-base-r"><i class="fa fa-check"></i><b>4.7</b> More on plots with base R</a><ul>
<li class="chapter" data-level="4.7.1" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#multi-frame-plot"><i class="fa fa-check"></i><b>4.7.1</b> Multi-frame plot</a></li>
<li class="chapter" data-level="4.7.2" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#subsubsec:type_of_plot"><i class="fa fa-check"></i><b>4.7.2</b> Type of Plot</a></li>
<li class="chapter" data-level="4.7.3" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#parameters-of-a-plot"><i class="fa fa-check"></i><b>4.7.3</b> Parameters of a plot</a></li>
<li class="chapter" data-level="4.7.4" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#elements-on-plot"><i class="fa fa-check"></i><b>4.7.4</b> Elements on plot</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="creating-some-basic-plots.html"><a href="creating-some-basic-plots.html#summary-of-ggplot"><i class="fa fa-check"></i><b>4.8</b> Summary of <code>ggplot</code></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="managing-data-with-r.html"><a href="managing-data-with-r.html"><i class="fa fa-check"></i><b>5</b> Managing Data with R</a><ul>
<li class="chapter" data-level="5.1" data-path="managing-data-with-r.html"><a href="managing-data-with-r.html#missing-values"><i class="fa fa-check"></i><b>5.1</b> Missing Values</a></li>
<li class="chapter" data-level="5.2" data-path="managing-data-with-r.html"><a href="managing-data-with-r.html#saving-loading-and-removing-r-data-structures"><i class="fa fa-check"></i><b>5.2</b> Saving, loading, and removing R data structures</a></li>
<li class="chapter" data-level="5.3" data-path="managing-data-with-r.html"><a href="managing-data-with-r.html#importing-and-saving-data-from-csv-files"><i class="fa fa-check"></i><b>5.3</b> Importing and saving data from CSV files</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="review-chapter-1-5.html"><a href="review-chapter-1-5.html"><i class="fa fa-check"></i><b>6</b> Review (Chapter 1-5)</a><ul>
<li class="chapter" data-level="6.1" data-path="review-chapter-1-5.html"><a href="review-chapter-1-5.html#simulation-1"><i class="fa fa-check"></i><b>6.1</b> Simulation</a></li>
<li class="chapter" data-level="6.2" data-path="review-chapter-1-5.html"><a href="review-chapter-1-5.html#matrix-1"><i class="fa fa-check"></i><b>6.2</b> Matrix</a></li>
<li class="chapter" data-level="6.3" data-path="review-chapter-1-5.html"><a href="review-chapter-1-5.html#basic-operation"><i class="fa fa-check"></i><b>6.3</b> Basic Operation</a></li>
<li class="chapter" data-level="6.4" data-path="review-chapter-1-5.html"><a href="review-chapter-1-5.html#some-basic-plots-in-r"><i class="fa fa-check"></i><b>6.4</b> Some basic plots in R</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html"><i class="fa fa-check"></i><b>7</b> Data Transformation with <code>dplyr</code></a><ul>
<li class="chapter" data-level="7.1" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#arrange"><i class="fa fa-check"></i><b>7.2</b> <code>arrange()</code></a><ul>
<li class="chapter" data-level="7.2.1" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#exercises-2"><i class="fa fa-check"></i><b>7.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#filter"><i class="fa fa-check"></i><b>7.3</b> <code>filter()</code></a><ul>
<li class="chapter" data-level="7.3.1" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#exercises-3"><i class="fa fa-check"></i><b>7.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#select"><i class="fa fa-check"></i><b>7.4</b> <code>select()</code></a><ul>
<li class="chapter" data-level="7.4.1" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#exercises-4"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#mutate"><i class="fa fa-check"></i><b>7.5</b> <code>mutate()</code></a><ul>
<li class="chapter" data-level="7.5.1" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#exercises-5"><i class="fa fa-check"></i><b>7.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#summarize-group_by"><i class="fa fa-check"></i><b>7.6</b> <code>summarize(), group_by()</code></a></li>
<li class="chapter" data-level="7.7" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#combining-multiple-operations-with-pipe"><i class="fa fa-check"></i><b>7.7</b> Combining Multiple Operations with Pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="7.8" data-path="data-transformation-with-dplyr.html"><a href="data-transformation-with-dplyr.html#summary"><i class="fa fa-check"></i><b>7.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html"><i class="fa fa-check"></i><b>8</b> Data Visualization with ggplot2</a><ul>
<li class="chapter" data-level="8.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#bar-charts"><i class="fa fa-check"></i><b>8.1</b> Bar charts</a></li>
<li class="chapter" data-level="8.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#line-graph-1"><i class="fa fa-check"></i><b>8.2</b> Line Graph</a></li>
<li class="chapter" data-level="8.3" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#scatter-plots"><i class="fa fa-check"></i><b>8.3</b> Scatter Plots</a><ul>
<li class="chapter" data-level="8.3.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#overplotting"><i class="fa fa-check"></i><b>8.3.1</b> Overplotting</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#labelling-points-in-a-scatter-plot"><i class="fa fa-check"></i><b>8.3.2</b> Labelling points in a scatter plot</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#summarizing-data-distributions"><i class="fa fa-check"></i><b>8.4</b> Summarizing Data Distributions</a><ul>
<li class="chapter" data-level="8.4.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#histogram-1"><i class="fa fa-check"></i><b>8.4.1</b> Histogram</a></li>
<li class="chapter" data-level="8.4.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#kernel-density-estimate"><i class="fa fa-check"></i><b>8.4.2</b> Kernel Density Estimate</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#saving-your-plots"><i class="fa fa-check"></i><b>8.5</b> Saving your plots</a><ul>
<li class="chapter" data-level="8.5.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#outputting-to-pdf-vector-files"><i class="fa fa-check"></i><b>8.5.1</b> Outputting to pdf vector files</a></li>
<li class="chapter" data-level="8.5.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#outputting-to-bitmap-files"><i class="fa fa-check"></i><b>8.5.2</b> Outputting to bitmap files</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#summary-1"><i class="fa fa-check"></i><b>8.6</b> Summary</a><ul>
<li class="chapter" data-level="8.6.1" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#combining-multiple-operations-with-pipe-1"><i class="fa fa-check"></i><b>8.6.1</b> Combining multiple operations with pipe <code>%&gt;%</code></a></li>
<li class="chapter" data-level="8.6.2" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#bar-charts-1"><i class="fa fa-check"></i><b>8.6.2</b> Bar charts</a></li>
<li class="chapter" data-level="8.6.3" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#line-graphs"><i class="fa fa-check"></i><b>8.6.3</b> Line graphs</a></li>
<li class="chapter" data-level="8.6.4" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#scatter-plot-1"><i class="fa fa-check"></i><b>8.6.4</b> Scatter plot</a></li>
<li class="chapter" data-level="8.6.5" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#summarizing-data-distributions-1"><i class="fa fa-check"></i><b>8.6.5</b> Summarizing data distributions</a></li>
<li class="chapter" data-level="8.6.6" data-path="data-visualization-with-ggplot2.html"><a href="data-visualization-with-ggplot2.html#saving-your-plots-1"><i class="fa fa-check"></i><b>8.6.6</b> Saving your plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html"><i class="fa fa-check"></i><b>9</b> Statistical Inference in R</a><ul>
<li class="chapter" data-level="9.1" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#maximum-likelihood-estimation"><i class="fa fa-check"></i><b>9.1</b> Maximum Likelihood Estimation</a><ul>
<li class="chapter" data-level="9.1.1" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#exercises-on-mle"><i class="fa fa-check"></i><b>9.1.1</b> Exercises on MLE</a></li>
<li class="chapter" data-level="9.1.2" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#summary-2"><i class="fa fa-check"></i><b>9.1.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#interval-estimation-and-hypothesis-testing"><i class="fa fa-check"></i><b>9.2</b> Interval Estimation and Hypothesis Testing</a><ul>
<li class="chapter" data-level="9.2.1" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#examples-of-hypothesis-testing"><i class="fa fa-check"></i><b>9.2.1</b> Examples of Hypothesis Testing</a></li>
<li class="chapter" data-level="9.2.2" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#null-hypotheses-alternative-hypotheses-and-p-values"><i class="fa fa-check"></i><b>9.2.2</b> Null Hypotheses, Alternative Hypotheses, and p-values</a></li>
<li class="chapter" data-level="9.2.3" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#type-i-error-and-type-ii-error"><i class="fa fa-check"></i><b>9.2.3</b> Type I error and Type II error</a></li>
<li class="chapter" data-level="9.2.4" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#inference-for-mean-of-one-sample"><i class="fa fa-check"></i><b>9.2.4</b> Inference for Mean of One Sample</a></li>
<li class="chapter" data-level="9.2.5" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#comparing-the-means-of-two-samples"><i class="fa fa-check"></i><b>9.2.5</b> Comparing the means of two samples</a></li>
<li class="chapter" data-level="9.2.6" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#inference-of-a-sample-proportion"><i class="fa fa-check"></i><b>9.2.6</b> Inference of a Sample Proportion</a></li>
<li class="chapter" data-level="9.2.7" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#testing-groups-for-equal-proportions"><i class="fa fa-check"></i><b>9.2.7</b> Testing groups for equal proportions</a></li>
<li class="chapter" data-level="9.2.8" data-path="statistical-inference-in-r.html"><a href="statistical-inference-in-r.html#testing-if-two-samples-have-the-same-underlying-distribution"><i class="fa fa-check"></i><b>9.2.8</b> Testing if two samples have the same underlying distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html"><i class="fa fa-check"></i><b>10</b> Root finding and optimization</a><ul>
<li class="chapter" data-level="10.1" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#root-finding"><i class="fa fa-check"></i><b>10.1</b> Root Finding</a><ul>
<li class="chapter" data-level="10.1.1" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#bisection-method"><i class="fa fa-check"></i><b>10.1.1</b> Bisection Method</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#newton-raphson-method"><i class="fa fa-check"></i><b>10.2</b> Newton-Raphson Method</a></li>
<li class="chapter" data-level="10.3" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#minimization-and-maximization"><i class="fa fa-check"></i><b>10.3</b> Minimization and Maximization</a><ul>
<li class="chapter" data-level="10.3.1" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#newton-raphson-method-1"><i class="fa fa-check"></i><b>10.3.1</b> Newton-Raphson Method</a></li>
<li class="chapter" data-level="10.3.2" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#gradient-descent"><i class="fa fa-check"></i><b>10.3.2</b> Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="root-finding-and-optimization.html"><a href="root-finding-and-optimization.html#optim"><i class="fa fa-check"></i><b>10.4</b> <code>optim</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html"><i class="fa fa-check"></i><b>11</b> k-nearest neighbors</a><ul>
<li class="chapter" data-level="11.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#introduction-2"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#feature-scaling"><i class="fa fa-check"></i><b>11.2</b> Feature Scaling</a></li>
<li class="chapter" data-level="11.3" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#example-classifying-breast-cancers"><i class="fa fa-check"></i><b>11.3</b> Example: Classifying Breast Cancers</a><ul>
<li class="chapter" data-level="11.3.1" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#evaluating-model-performance"><i class="fa fa-check"></i><b>11.3.1</b> Evaluating Model Performance</a></li>
<li class="chapter" data-level="11.3.2" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#using-z-score-standardization"><i class="fa fa-check"></i><b>11.3.2</b> Using <span class="math inline">\(z\)</span>-score standardization</a></li>
<li class="chapter" data-level="11.3.3" data-path="k-nearest-neighbors.html"><a href="k-nearest-neighbors.html#testing-alternative-values-of-k"><i class="fa fa-check"></i><b>11.3.3</b> Testing alternative values of <span class="math inline">\(k\)</span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="classification-trees.html"><a href="classification-trees.html"><i class="fa fa-check"></i><b>12</b> Classification Trees</a><ul>
<li class="chapter" data-level="12.1" data-path="classification-trees.html"><a href="classification-trees.html#introduction-3"><i class="fa fa-check"></i><b>12.1</b> Introduction</a></li>
<li class="chapter" data-level="12.2" data-path="classification-trees.html"><a href="classification-trees.html#the-c5.0-classification-tree-algorithm"><i class="fa fa-check"></i><b>12.2</b> The C5.0 classification tree algorithm</a><ul>
<li class="chapter" data-level="12.2.1" data-path="classification-trees.html"><a href="classification-trees.html#choosing-the-best-split"><i class="fa fa-check"></i><b>12.2.1</b> Choosing the best split</a></li>
<li class="chapter" data-level="12.2.2" data-path="classification-trees.html"><a href="classification-trees.html#pruning-the-decision-tree"><i class="fa fa-check"></i><b>12.2.2</b> Pruning the decision tree</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="classification-trees.html"><a href="classification-trees.html#example-iris"><i class="fa fa-check"></i><b>12.3</b> Example: <code>iris</code></a></li>
<li class="chapter" data-level="12.4" data-path="classification-trees.html"><a href="classification-trees.html#example-identifying-risky-bank-loans"><i class="fa fa-check"></i><b>12.4</b> Example: identifying risky bank loans</a><ul>
<li class="chapter" data-level="12.4.1" data-path="classification-trees.html"><a href="classification-trees.html#adaptive-boosting"><i class="fa fa-check"></i><b>12.4.1</b> Adaptive boosting</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="linear-regression-models.html"><a href="linear-regression-models.html"><i class="fa fa-check"></i><b>13</b> Linear Regression Models</a><ul>
<li class="chapter" data-level="13.1" data-path="linear-regression-models.html"><a href="linear-regression-models.html#simple-linear-regression"><i class="fa fa-check"></i><b>13.1</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="13.2" data-path="linear-regression-models.html"><a href="linear-regression-models.html#smoothed-conditional-means"><i class="fa fa-check"></i><b>13.2</b> Smoothed Conditional Means</a></li>
<li class="chapter" data-level="13.3" data-path="linear-regression-models.html"><a href="linear-regression-models.html#multiple-linear-regression"><i class="fa fa-check"></i><b>13.3</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="13.4" data-path="linear-regression-models.html"><a href="linear-regression-models.html#example-diamonds"><i class="fa fa-check"></i><b>13.4</b> Example: <code>diamonds</code></a></li>
<li class="chapter" data-level="13.5" data-path="linear-regression-models.html"><a href="linear-regression-models.html#categorical-predictors"><i class="fa fa-check"></i><b>13.5</b> Categorical Predictors</a></li>
<li class="chapter" data-level="13.6" data-path="linear-regression-models.html"><a href="linear-regression-models.html#compare-models-using-anova"><i class="fa fa-check"></i><b>13.6</b> Compare models using ANOVA</a></li>
<li class="chapter" data-level="13.7" data-path="linear-regression-models.html"><a href="linear-regression-models.html#prediction"><i class="fa fa-check"></i><b>13.7</b> Prediction</a></li>
<li class="chapter" data-level="13.8" data-path="linear-regression-models.html"><a href="linear-regression-models.html#interaction-terms"><i class="fa fa-check"></i><b>13.8</b> Interaction Terms</a></li>
<li class="chapter" data-level="13.9" data-path="linear-regression-models.html"><a href="linear-regression-models.html#variable-transformation"><i class="fa fa-check"></i><b>13.9</b> Variable Transformation</a></li>
<li class="chapter" data-level="13.10" data-path="linear-regression-models.html"><a href="linear-regression-models.html#polynomial-regression"><i class="fa fa-check"></i><b>13.10</b> Polynomial Regression</a></li>
<li class="chapter" data-level="13.11" data-path="linear-regression-models.html"><a href="linear-regression-models.html#stepwise-regression"><i class="fa fa-check"></i><b>13.11</b> Stepwise regression</a></li>
<li class="chapter" data-level="13.12" data-path="linear-regression-models.html"><a href="linear-regression-models.html#best-subset"><i class="fa fa-check"></i><b>13.12</b> Best subset</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="logistic-regression-model.html"><a href="logistic-regression-model.html"><i class="fa fa-check"></i><b>14</b> Logistic Regression Model</a></li>
<li class="chapter" data-level="15" data-path="k-means-clustering.html"><a href="k-means-clustering.html"><i class="fa fa-check"></i><b>15</b> k-means Clustering</a><ul>
<li class="chapter" data-level="15.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html#introduction-4"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="k-means-clustering.html"><a href="k-means-clustering.html#applications"><i class="fa fa-check"></i><b>15.2</b> Applications</a><ul>
<li class="chapter" data-level="15.2.1" data-path="k-means-clustering.html"><a href="k-means-clustering.html#cluster-analysis"><i class="fa fa-check"></i><b>15.2.1</b> Cluster Analysis</a></li>
<li class="chapter" data-level="15.2.2" data-path="k-means-clustering.html"><a href="k-means-clustering.html#image-segementation"><i class="fa fa-check"></i><b>15.2.2</b> Image Segementation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="neural-networks.html"><a href="neural-networks.html"><i class="fa fa-check"></i><b>16</b> Neural Networks</a><ul>
<li class="chapter" data-level="16.1" data-path="neural-networks.html"><a href="neural-networks.html#introduction-5"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="neural-networks.html"><a href="neural-networks.html#regression-predict-the-strength-of-concrete"><i class="fa fa-check"></i><b>16.2</b> Regression: Predict the Strength of Concrete</a><ul>
<li class="chapter" data-level="16.2.1" data-path="neural-networks.html"><a href="neural-networks.html#data"><i class="fa fa-check"></i><b>16.2.1</b> Data</a></li>
<li class="chapter" data-level="16.2.2" data-path="neural-networks.html"><a href="neural-networks.html#training-a-model"><i class="fa fa-check"></i><b>16.2.2</b> Training a model</a></li>
<li class="chapter" data-level="16.2.3" data-path="neural-networks.html"><a href="neural-networks.html#understanding-the-model"><i class="fa fa-check"></i><b>16.2.3</b> Understanding the model</a></li>
<li class="chapter" data-level="16.2.4" data-path="neural-networks.html"><a href="neural-networks.html#evaluating-the-performance"><i class="fa fa-check"></i><b>16.2.4</b> Evaluating the Performance</a></li>
<li class="chapter" data-level="16.2.5" data-path="neural-networks.html"><a href="neural-networks.html#improving-the-model"><i class="fa fa-check"></i><b>16.2.5</b> Improving the Model</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="neural-networks.html"><a href="neural-networks.html#classification"><i class="fa fa-check"></i><b>16.3</b> Classification</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html"><i class="fa fa-check"></i><b>17</b> Evaluating Model Performance</a><ul>
<li class="chapter" data-level="17.1" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#accuracy-and-confusion-matrix"><i class="fa fa-check"></i><b>17.1</b> Accuracy and Confusion Matrix</a></li>
<li class="chapter" data-level="17.2" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#other-measures-of-performance"><i class="fa fa-check"></i><b>17.2</b> Other Measures of Performance</a><ul>
<li class="chapter" data-level="17.2.1" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#the-kappa-statistic"><i class="fa fa-check"></i><b>17.2.1</b> The kappa statistic</a></li>
<li class="chapter" data-level="17.2.2" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#sensitivity-and-specificity"><i class="fa fa-check"></i><b>17.2.2</b> Sensitivity and specificity</a></li>
<li class="chapter" data-level="17.2.3" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#roc-and-auc"><i class="fa fa-check"></i><b>17.2.3</b> ROC and AUC</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#estimating-future-performances"><i class="fa fa-check"></i><b>17.3</b> Estimating future performances</a><ul>
<li class="chapter" data-level="17.3.1" data-path="evaluating-model-performance-1.html"><a href="evaluating-model-performance-1.html#cross-validation"><i class="fa fa-check"></i><b>17.3.1</b> Cross-validation</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 362 R for Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-transformation-with-dplyr" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> Data Transformation with <code>dplyr</code></h1>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>Reference: see <a href="https://r4ds.had.co.nz/transform.html" class="uri">https://r4ds.had.co.nz/transform.html</a></p>
<p><strong>Preparation</strong></p>
<p>We will use a dataset in the package <code>nycflights13</code>. To install it:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="data-transformation-with-dplyr.html#cb179-1"></a><span class="kw">install.packages</span>(<span class="st">&quot;nycflights13&quot;</span>)</span></code></pre></div>
<p>To use the dataset or functions in the package, we first load the library:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="data-transformation-with-dplyr.html#cb180-1"></a><span class="kw">library</span>(nycflights13)</span></code></pre></div>
<p>In Chapter 4, we have installed <code>tidyverse</code>, which contains the package <code>dplyr</code>. Now, load the package</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="data-transformation-with-dplyr.html#cb181-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p><strong>nycflights13</strong></p>
<p>The dataset <code>flights</code> in the package <code>nyclfights13</code> contains all <span class="math inline">\(336,776\)</span> flights that departed from New York City in 2013. Check <code>?flights</code> for details.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="data-transformation-with-dplyr.html#cb182-1"></a><span class="co"># let&#39;s view the dataset</span></span>
<span id="cb182-2"><a href="data-transformation-with-dplyr.html#cb182-2"></a>flights</span>
<span id="cb182-3"><a href="data-transformation-with-dplyr.html#cb182-3"></a><span class="co">## # A tibble: 336,776 x 19</span></span>
<span id="cb182-4"><a href="data-transformation-with-dplyr.html#cb182-4"></a><span class="co">##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier</span></span>
<span id="cb182-5"><a href="data-transformation-with-dplyr.html#cb182-5"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb182-6"><a href="data-transformation-with-dplyr.html#cb182-6"></a><span class="co">##  1  2013     1     1      517            515         2      830            819        11 UA     </span></span>
<span id="cb182-7"><a href="data-transformation-with-dplyr.html#cb182-7"></a><span class="co">##  2  2013     1     1      533            529         4      850            830        20 UA     </span></span>
<span id="cb182-8"><a href="data-transformation-with-dplyr.html#cb182-8"></a><span class="co">##  3  2013     1     1      542            540         2      923            850        33 AA     </span></span>
<span id="cb182-9"><a href="data-transformation-with-dplyr.html#cb182-9"></a><span class="co">##  4  2013     1     1      544            545        -1     1004           1022       -18 B6     </span></span>
<span id="cb182-10"><a href="data-transformation-with-dplyr.html#cb182-10"></a><span class="co">##  5  2013     1     1      554            600        -6      812            837       -25 DL     </span></span>
<span id="cb182-11"><a href="data-transformation-with-dplyr.html#cb182-11"></a><span class="co">##  6  2013     1     1      554            558        -4      740            728        12 UA     </span></span>
<span id="cb182-12"><a href="data-transformation-with-dplyr.html#cb182-12"></a><span class="co">##  7  2013     1     1      555            600        -5      913            854        19 B6     </span></span>
<span id="cb182-13"><a href="data-transformation-with-dplyr.html#cb182-13"></a><span class="co">##  8  2013     1     1      557            600        -3      709            723       -14 EV     </span></span>
<span id="cb182-14"><a href="data-transformation-with-dplyr.html#cb182-14"></a><span class="co">##  9  2013     1     1      557            600        -3      838            846        -8 B6     </span></span>
<span id="cb182-15"><a href="data-transformation-with-dplyr.html#cb182-15"></a><span class="co">## 10  2013     1     1      558            600        -2      753            745         8 AA     </span></span>
<span id="cb182-16"><a href="data-transformation-with-dplyr.html#cb182-16"></a><span class="co">## # ... with 336,766 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb182-17"><a href="data-transformation-with-dplyr.html#cb182-17"></a><span class="co">## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code></pre></div>
<p><code>flights</code> is a tibble. Tibbles are data frames with better properties.</p>
<p><strong>Optional</strong>: If you are interested in the differences between a <code>data frame</code> and a <code>tibble</code>, you can go to
<a href="https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html" class="uri">https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html</a></p>
<p>To view the complete dataset, use <code>View(flights)</code>.</p>
<p><strong>Five key dplyr functions</strong></p>
<ol style="list-style-type: decimal">
<li><code>arrange()</code>: reorder the rows</li>
<li><code>fliter()</code>: pick observations by their values</li>
<li><code>select()</code>: pick variables by their names</li>
<li><code>mutate()</code>: create new variables with functions of existing variables</li>
<li><code>summarize()</code>: collapse many values down to a single summary
<!-- 6. `group_by()`: changes the scope of each function from operating on the entire dataset to operating on it group-by-group --></li>
</ol>
<p>All functions work similarly:</p>
<ol style="list-style-type: decimal">
<li>The first argument is a data frame/ tibble</li>
<li>The subsequent argument describe what to do with the data frame, using the variable names (without quotes).</li>
<li>The result is a new data frame.</li>
</ol>
<p>Of course, it is also possible to perform the same tasks without using <code>dplyr</code> functions. We will also discuss briefly how to use the base subsetting with <code>[]</code> to select the data. In general, the functions in <code>dplyr</code> are designed to transform the data more easily.</p>
</div>
<div id="arrange" class="section level2">
<h2><span class="header-section-number">7.2</span> <code>arrange()</code></h2>
<p><code>arrange()</code> orders your dataset. If more than one column name is provided, each additional column will be used to break ties in the values of preceding columns.</p>
<p>To reorder by a column in <strong>ascending order</strong>:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="data-transformation-with-dplyr.html#cb183-1"></a><span class="kw">arrange</span>(flights, year, month, day)</span></code></pre></div>
<p>Let’s create a simple dataset to illustrate this because <code>flights</code> is already sorted in year, month and day.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="data-transformation-with-dplyr.html#cb184-1"></a>(data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)))</span>
<span id="cb184-2"><a href="data-transformation-with-dplyr.html#cb184-2"></a><span class="co">## # A tibble: 5 x 2</span></span>
<span id="cb184-3"><a href="data-transformation-with-dplyr.html#cb184-3"></a><span class="co">##       x     y</span></span>
<span id="cb184-4"><a href="data-transformation-with-dplyr.html#cb184-4"></a><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb184-5"><a href="data-transformation-with-dplyr.html#cb184-5"></a><span class="co">## 1     2     2</span></span>
<span id="cb184-6"><a href="data-transformation-with-dplyr.html#cb184-6"></a><span class="co">## 2     2     3</span></span>
<span id="cb184-7"><a href="data-transformation-with-dplyr.html#cb184-7"></a><span class="co">## 3     1    10</span></span>
<span id="cb184-8"><a href="data-transformation-with-dplyr.html#cb184-8"></a><span class="co">## 4     4    10</span></span>
<span id="cb184-9"><a href="data-transformation-with-dplyr.html#cb184-9"></a><span class="co">## 5     5    10</span></span>
<span id="cb184-10"><a href="data-transformation-with-dplyr.html#cb184-10"></a></span>
<span id="cb184-11"><a href="data-transformation-with-dplyr.html#cb184-11"></a><span class="kw">arrange</span>(data, x)</span>
<span id="cb184-12"><a href="data-transformation-with-dplyr.html#cb184-12"></a><span class="co">## # A tibble: 5 x 2</span></span>
<span id="cb184-13"><a href="data-transformation-with-dplyr.html#cb184-13"></a><span class="co">##       x     y</span></span>
<span id="cb184-14"><a href="data-transformation-with-dplyr.html#cb184-14"></a><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb184-15"><a href="data-transformation-with-dplyr.html#cb184-15"></a><span class="co">## 1     1    10</span></span>
<span id="cb184-16"><a href="data-transformation-with-dplyr.html#cb184-16"></a><span class="co">## 2     2     2</span></span>
<span id="cb184-17"><a href="data-transformation-with-dplyr.html#cb184-17"></a><span class="co">## 3     2     3</span></span>
<span id="cb184-18"><a href="data-transformation-with-dplyr.html#cb184-18"></a><span class="co">## 4     4    10</span></span>
<span id="cb184-19"><a href="data-transformation-with-dplyr.html#cb184-19"></a><span class="co">## 5     5    10</span></span>
<span id="cb184-20"><a href="data-transformation-with-dplyr.html#cb184-20"></a></span>
<span id="cb184-21"><a href="data-transformation-with-dplyr.html#cb184-21"></a><span class="co"># first sort in ascending order of x, use y to break any ties and sort in descending order</span></span>
<span id="cb184-22"><a href="data-transformation-with-dplyr.html#cb184-22"></a><span class="kw">arrange</span>(data, x, <span class="kw">desc</span>(y))</span>
<span id="cb184-23"><a href="data-transformation-with-dplyr.html#cb184-23"></a><span class="co">## # A tibble: 5 x 2</span></span>
<span id="cb184-24"><a href="data-transformation-with-dplyr.html#cb184-24"></a><span class="co">##       x     y</span></span>
<span id="cb184-25"><a href="data-transformation-with-dplyr.html#cb184-25"></a><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb184-26"><a href="data-transformation-with-dplyr.html#cb184-26"></a><span class="co">## 1     1    10</span></span>
<span id="cb184-27"><a href="data-transformation-with-dplyr.html#cb184-27"></a><span class="co">## 2     2     3</span></span>
<span id="cb184-28"><a href="data-transformation-with-dplyr.html#cb184-28"></a><span class="co">## 3     2     2</span></span>
<span id="cb184-29"><a href="data-transformation-with-dplyr.html#cb184-29"></a><span class="co">## 4     4    10</span></span>
<span id="cb184-30"><a href="data-transformation-with-dplyr.html#cb184-30"></a><span class="co">## 5     5    10</span></span></code></pre></div>
<p>To reorder by a column in <strong>descending order</strong>, use <code>desc()</code>:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="data-transformation-with-dplyr.html#cb185-1"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(arr_delay))</span></code></pre></div>
<p>Missing values are always sorted at the end</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="data-transformation-with-dplyr.html#cb186-1"></a><span class="co"># create a tibble with one column called x with values 5,2,NA</span></span>
<span id="cb186-2"><a href="data-transformation-with-dplyr.html#cb186-2"></a>df &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">2</span>, <span class="ot">NA</span>)) </span>
<span id="cb186-3"><a href="data-transformation-with-dplyr.html#cb186-3"></a><span class="kw">arrange</span>(df, x)</span>
<span id="cb186-4"><a href="data-transformation-with-dplyr.html#cb186-4"></a><span class="co">## # A tibble: 3 x 1</span></span>
<span id="cb186-5"><a href="data-transformation-with-dplyr.html#cb186-5"></a><span class="co">##       x</span></span>
<span id="cb186-6"><a href="data-transformation-with-dplyr.html#cb186-6"></a><span class="co">##   &lt;dbl&gt;</span></span>
<span id="cb186-7"><a href="data-transformation-with-dplyr.html#cb186-7"></a><span class="co">## 1     2</span></span>
<span id="cb186-8"><a href="data-transformation-with-dplyr.html#cb186-8"></a><span class="co">## 2     5</span></span>
<span id="cb186-9"><a href="data-transformation-with-dplyr.html#cb186-9"></a><span class="co">## 3    NA</span></span>
<span id="cb186-10"><a href="data-transformation-with-dplyr.html#cb186-10"></a></span>
<span id="cb186-11"><a href="data-transformation-with-dplyr.html#cb186-11"></a><span class="kw">arrange</span>(df, <span class="kw">desc</span>(x))</span>
<span id="cb186-12"><a href="data-transformation-with-dplyr.html#cb186-12"></a><span class="co">## # A tibble: 3 x 1</span></span>
<span id="cb186-13"><a href="data-transformation-with-dplyr.html#cb186-13"></a><span class="co">##       x</span></span>
<span id="cb186-14"><a href="data-transformation-with-dplyr.html#cb186-14"></a><span class="co">##   &lt;dbl&gt;</span></span>
<span id="cb186-15"><a href="data-transformation-with-dplyr.html#cb186-15"></a><span class="co">## 1     5</span></span>
<span id="cb186-16"><a href="data-transformation-with-dplyr.html#cb186-16"></a><span class="co">## 2     2</span></span>
<span id="cb186-17"><a href="data-transformation-with-dplyr.html#cb186-17"></a><span class="co">## 3    NA</span></span></code></pre></div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li>Sort <code>flights</code> to find the most delayed flights. Find the flights that left earliest.</li>
</ol>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="data-transformation-with-dplyr.html#cb187-1"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</span>
<span id="cb187-2"><a href="data-transformation-with-dplyr.html#cb187-2"></a></span>
<span id="cb187-3"><a href="data-transformation-with-dplyr.html#cb187-3"></a><span class="kw">arrange</span>(flights, dep_delay)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Which flights traveled the longest? Which traveled the shortest?</li>
</ol>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="data-transformation-with-dplyr.html#cb188-1"></a><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</span>
<span id="cb188-2"><a href="data-transformation-with-dplyr.html#cb188-2"></a></span>
<span id="cb188-3"><a href="data-transformation-with-dplyr.html#cb188-3"></a><span class="kw">arrange</span>(flights, distance)</span></code></pre></div>
</div>
</div>
<div id="filter" class="section level2">
<h2><span class="header-section-number">7.3</span> <code>filter()</code></h2>
<p><strong><code>filter()</code> only includes rows where the condition is <code>TRUE</code></strong></p>
<p>Select all flights on Jan 1st:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="data-transformation-with-dplyr.html#cb189-1"></a><span class="co"># flights is the name of your data frame</span></span>
<span id="cb189-2"><a href="data-transformation-with-dplyr.html#cb189-2"></a><span class="co"># month == 1, day == 1 is the condition</span></span>
<span id="cb189-3"><a href="data-transformation-with-dplyr.html#cb189-3"></a>(jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</span>
<span id="cb189-4"><a href="data-transformation-with-dplyr.html#cb189-4"></a><span class="co">## # A tibble: 842 x 19</span></span>
<span id="cb189-5"><a href="data-transformation-with-dplyr.html#cb189-5"></a><span class="co">##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier</span></span>
<span id="cb189-6"><a href="data-transformation-with-dplyr.html#cb189-6"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb189-7"><a href="data-transformation-with-dplyr.html#cb189-7"></a><span class="co">##  1  2013     1     1      517            515         2      830            819        11 UA     </span></span>
<span id="cb189-8"><a href="data-transformation-with-dplyr.html#cb189-8"></a><span class="co">##  2  2013     1     1      533            529         4      850            830        20 UA     </span></span>
<span id="cb189-9"><a href="data-transformation-with-dplyr.html#cb189-9"></a><span class="co">##  3  2013     1     1      542            540         2      923            850        33 AA     </span></span>
<span id="cb189-10"><a href="data-transformation-with-dplyr.html#cb189-10"></a><span class="co">##  4  2013     1     1      544            545        -1     1004           1022       -18 B6     </span></span>
<span id="cb189-11"><a href="data-transformation-with-dplyr.html#cb189-11"></a><span class="co">##  5  2013     1     1      554            600        -6      812            837       -25 DL     </span></span>
<span id="cb189-12"><a href="data-transformation-with-dplyr.html#cb189-12"></a><span class="co">##  6  2013     1     1      554            558        -4      740            728        12 UA     </span></span>
<span id="cb189-13"><a href="data-transformation-with-dplyr.html#cb189-13"></a><span class="co">##  7  2013     1     1      555            600        -5      913            854        19 B6     </span></span>
<span id="cb189-14"><a href="data-transformation-with-dplyr.html#cb189-14"></a><span class="co">##  8  2013     1     1      557            600        -3      709            723       -14 EV     </span></span>
<span id="cb189-15"><a href="data-transformation-with-dplyr.html#cb189-15"></a><span class="co">##  9  2013     1     1      557            600        -3      838            846        -8 B6     </span></span>
<span id="cb189-16"><a href="data-transformation-with-dplyr.html#cb189-16"></a><span class="co">## 10  2013     1     1      558            600        -2      753            745         8 AA     </span></span>
<span id="cb189-17"><a href="data-transformation-with-dplyr.html#cb189-17"></a><span class="co">## # ... with 832 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb189-18"><a href="data-transformation-with-dplyr.html#cb189-18"></a><span class="co">## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code></pre></div>
<p>Let’s use a simple dataset to see how to perform the same task without <code>filter</code>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="data-transformation-with-dplyr.html#cb190-1"></a><span class="co"># just a simple dataset</span></span>
<span id="cb190-2"><a href="data-transformation-with-dplyr.html#cb190-2"></a>(data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">3</span>), <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</span>
<span id="cb190-3"><a href="data-transformation-with-dplyr.html#cb190-3"></a><span class="co">## # A tibble: 5 x 2</span></span>
<span id="cb190-4"><a href="data-transformation-with-dplyr.html#cb190-4"></a><span class="co">##       x     y</span></span>
<span id="cb190-5"><a href="data-transformation-with-dplyr.html#cb190-5"></a><span class="co">##   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb190-6"><a href="data-transformation-with-dplyr.html#cb190-6"></a><span class="co">## 1     1     1</span></span>
<span id="cb190-7"><a href="data-transformation-with-dplyr.html#cb190-7"></a><span class="co">## 2     3     2</span></span>
<span id="cb190-8"><a href="data-transformation-with-dplyr.html#cb190-8"></a><span class="co">## 3     5     3</span></span>
<span id="cb190-9"><a href="data-transformation-with-dplyr.html#cb190-9"></a><span class="co">## 4     5     4</span></span>
<span id="cb190-10"><a href="data-transformation-with-dplyr.html#cb190-10"></a><span class="co">## 5     3     5</span></span>
<span id="cb190-11"><a href="data-transformation-with-dplyr.html#cb190-11"></a></span>
<span id="cb190-12"><a href="data-transformation-with-dplyr.html#cb190-12"></a>data<span class="op">$</span>x <span class="op">==</span><span class="st"> </span><span class="dv">5</span> <span class="co"># logical vector</span></span>
<span id="cb190-13"><a href="data-transformation-with-dplyr.html#cb190-13"></a><span class="co">## [1] FALSE FALSE  TRUE  TRUE FALSE</span></span>
<span id="cb190-14"><a href="data-transformation-with-dplyr.html#cb190-14"></a></span>
<span id="cb190-15"><a href="data-transformation-with-dplyr.html#cb190-15"></a>data[data<span class="op">$</span>x <span class="op">==</span><span class="st"> </span><span class="dv">5</span>, ] <span class="co"># select the rows with value &quot;TRUE&quot;</span></span>
<span id="cb190-16"><a href="data-transformation-with-dplyr.html#cb190-16"></a><span class="co">## # A tibble: 2 x 2</span></span>
<span id="cb190-17"><a href="data-transformation-with-dplyr.html#cb190-17"></a><span class="co">##       x     y</span></span>
<span id="cb190-18"><a href="data-transformation-with-dplyr.html#cb190-18"></a><span class="co">##   &lt;dbl&gt; &lt;int&gt;</span></span>
<span id="cb190-19"><a href="data-transformation-with-dplyr.html#cb190-19"></a><span class="co">## 1     5     3</span></span>
<span id="cb190-20"><a href="data-transformation-with-dplyr.html#cb190-20"></a><span class="co">## 2     5     4</span></span>
<span id="cb190-21"><a href="data-transformation-with-dplyr.html#cb190-21"></a></span>
<span id="cb190-22"><a href="data-transformation-with-dplyr.html#cb190-22"></a><span class="co"># returning to the flights dataset</span></span>
<span id="cb190-23"><a href="data-transformation-with-dplyr.html#cb190-23"></a>base_jan1 &lt;-<span class="st"> </span>flights[(flights<span class="op">$</span>month <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>flights<span class="op">$</span>day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), ]</span></code></pre></div>
<p><code>(flights$month == 1 &amp; flights$day == 1)</code> is a logical vector indicating if the corresponding flight was on Jan 1 (<code>TRUE</code> if yes).</p>
<p>Now, let’s check if <code>jan1</code> and <code>base_jan1</code> are the same using <code>identical</code>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="data-transformation-with-dplyr.html#cb191-1"></a><span class="kw">identical</span>(jan1, base_jan1) <span class="co"># TURE means they are the same, FALSE means they are not the same</span></span>
<span id="cb191-2"><a href="data-transformation-with-dplyr.html#cb191-2"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
<p><strong>More Examples</strong></p>
<p>Select flights that departed in <strong>Nov or Dec</strong></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="data-transformation-with-dplyr.html#cb192-1"></a><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>)</span>
<span id="cb192-2"><a href="data-transformation-with-dplyr.html#cb192-2"></a></span>
<span id="cb192-3"><a href="data-transformation-with-dplyr.html#cb192-3"></a><span class="co"># alternatively, simpler code</span></span>
<span id="cb192-4"><a href="data-transformation-with-dplyr.html#cb192-4"></a><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">12</span>))</span></code></pre></div>
<p>How to use the operator <code>%in%</code>?</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="data-transformation-with-dplyr.html#cb193-1"></a>y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb193-2"><a href="data-transformation-with-dplyr.html#cb193-2"></a></span>
<span id="cb193-3"><a href="data-transformation-with-dplyr.html#cb193-3"></a>x &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb193-4"><a href="data-transformation-with-dplyr.html#cb193-4"></a>x <span class="op">%in%</span><span class="st"> </span>y <span class="co">#whether 1 is in {1,3,5}</span></span>
<span id="cb193-5"><a href="data-transformation-with-dplyr.html#cb193-5"></a><span class="co">## [1] TRUE</span></span>
<span id="cb193-6"><a href="data-transformation-with-dplyr.html#cb193-6"></a></span>
<span id="cb193-7"><a href="data-transformation-with-dplyr.html#cb193-7"></a>x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">1</span>)</span>
<span id="cb193-8"><a href="data-transformation-with-dplyr.html#cb193-8"></a>x <span class="op">%in%</span><span class="st"> </span>y <span class="co"># check whether each element in x is in {1,3,5}</span></span>
<span id="cb193-9"><a href="data-transformation-with-dplyr.html#cb193-9"></a><span class="co">## [1]  TRUE  TRUE FALSE FALSE  TRUE</span></span></code></pre></div>
<p><code>%in%</code> also works with characters</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="data-transformation-with-dplyr.html#cb194-1"></a><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</span>
<span id="cb194-2"><a href="data-transformation-with-dplyr.html#cb194-2"></a><span class="co">## [1]  TRUE FALSE</span></span></code></pre></div>
<p>The result is <code>TRUE FALSE</code> because <code>"a"</code> is in <code>c("a", "c", "d")</code> and <code>"b"</code> is not in <code>c("a", "c", "d")</code>.</p>
<p>Perform the same task without <code>filter</code>:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="data-transformation-with-dplyr.html#cb195-1"></a>flights[flights<span class="op">$</span>month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>flights<span class="op">$</span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>,]</span>
<span id="cb195-2"><a href="data-transformation-with-dplyr.html#cb195-2"></a></span>
<span id="cb195-3"><a href="data-transformation-with-dplyr.html#cb195-3"></a><span class="co"># or </span></span>
<span id="cb195-4"><a href="data-transformation-with-dplyr.html#cb195-4"></a>flights[flights<span class="op">$</span>month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">12</span>), ]</span></code></pre></div>
<p>Flights that were <strong>not delayed</strong> (on arrival or departure) by <strong>more than two hours</strong>:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="data-transformation-with-dplyr.html#cb196-1"></a>delay1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>)</span></code></pre></div>
<p>Without using <code>filter</code></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="data-transformation-with-dplyr.html#cb197-1"></a>delay2 &lt;-<span class="st"> </span>flights[flights<span class="op">$</span>arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span> <span class="op">&amp;</span><span class="st"> </span>flights<span class="op">$</span>dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>, ]</span></code></pre></div>
<p>Let’s check if <code>delay1</code> and <code>delay2</code> are the same.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="data-transformation-with-dplyr.html#cb198-1"></a><span class="kw">identical</span>(delay1, delay2)</span>
<span id="cb198-2"><a href="data-transformation-with-dplyr.html#cb198-2"></a><span class="co">## [1] FALSE</span></span></code></pre></div>
<p>The result is <code>FALSE</code>, meaning <code>delay1</code> and <code>delay2</code> are not the same. Why? Because some elements in <code>flights$arr_delay &lt;= 120 &amp; flights$dep_delay &lt;= 120</code> are <code>NA</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="data-transformation-with-dplyr.html#cb199-1"></a><span class="co"># to find out the number of NA values</span></span>
<span id="cb199-2"><a href="data-transformation-with-dplyr.html#cb199-2"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(flights<span class="op">$</span>arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span> <span class="op">&amp;</span><span class="st"> </span>flights<span class="op">$</span>dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>))</span>
<span id="cb199-3"><a href="data-transformation-with-dplyr.html#cb199-3"></a><span class="co">## [1] 9304</span></span></code></pre></div>
<p>As a result, with the base subsetting method, a row with all <code>NA</code> values will be selected. On the other hand, for <code>filter</code>, when a condition evaluates to <code>NA</code>, the row will be dropped. Let’s create a small dataset to illustrate this. From now on, let’s try to use <code>tibble</code> instead of <code>data.frame</code>.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="data-transformation-with-dplyr.html#cb200-1"></a>data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>, <span class="dv">4</span>)) </span>
<span id="cb200-2"><a href="data-transformation-with-dplyr.html#cb200-2"></a></span>
<span id="cb200-3"><a href="data-transformation-with-dplyr.html#cb200-3"></a>data[data<span class="op">$</span>y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>, ] </span>
<span id="cb200-4"><a href="data-transformation-with-dplyr.html#cb200-4"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb200-5"><a href="data-transformation-with-dplyr.html#cb200-5"></a><span class="co">##       x     y</span></span>
<span id="cb200-6"><a href="data-transformation-with-dplyr.html#cb200-6"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb200-7"><a href="data-transformation-with-dplyr.html#cb200-7"></a><span class="co">## 1     1     1</span></span>
<span id="cb200-8"><a href="data-transformation-with-dplyr.html#cb200-8"></a><span class="co">## 2     2     2</span></span>
<span id="cb200-9"><a href="data-transformation-with-dplyr.html#cb200-9"></a><span class="co">## 3    NA    NA</span></span>
<span id="cb200-10"><a href="data-transformation-with-dplyr.html#cb200-10"></a></span>
<span id="cb200-11"><a href="data-transformation-with-dplyr.html#cb200-11"></a><span class="co"># to avoid the above problem</span></span>
<span id="cb200-12"><a href="data-transformation-with-dplyr.html#cb200-12"></a><span class="co"># which() returns which elements are TRUE</span></span>
<span id="cb200-13"><a href="data-transformation-with-dplyr.html#cb200-13"></a><span class="kw">which</span>(data<span class="op">$</span>y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>) <span class="co"># the result is 1, 2</span></span>
<span id="cb200-14"><a href="data-transformation-with-dplyr.html#cb200-14"></a><span class="co">## [1] 1 2</span></span>
<span id="cb200-15"><a href="data-transformation-with-dplyr.html#cb200-15"></a>data[<span class="kw">which</span>(data<span class="op">$</span>y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>), ] <span class="co"># select row 1, row 2</span></span>
<span id="cb200-16"><a href="data-transformation-with-dplyr.html#cb200-16"></a><span class="co">## # A tibble: 2 x 2</span></span>
<span id="cb200-17"><a href="data-transformation-with-dplyr.html#cb200-17"></a><span class="co">##       x     y</span></span>
<span id="cb200-18"><a href="data-transformation-with-dplyr.html#cb200-18"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb200-19"><a href="data-transformation-with-dplyr.html#cb200-19"></a><span class="co">## 1     1     1</span></span>
<span id="cb200-20"><a href="data-transformation-with-dplyr.html#cb200-20"></a><span class="co">## 2     2     2</span></span>
<span id="cb200-21"><a href="data-transformation-with-dplyr.html#cb200-21"></a></span>
<span id="cb200-22"><a href="data-transformation-with-dplyr.html#cb200-22"></a><span class="co"># using filter</span></span>
<span id="cb200-23"><a href="data-transformation-with-dplyr.html#cb200-23"></a><span class="kw">filter</span>(data, y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span>)</span>
<span id="cb200-24"><a href="data-transformation-with-dplyr.html#cb200-24"></a><span class="co">## # A tibble: 2 x 2</span></span>
<span id="cb200-25"><a href="data-transformation-with-dplyr.html#cb200-25"></a><span class="co">##       x     y</span></span>
<span id="cb200-26"><a href="data-transformation-with-dplyr.html#cb200-26"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb200-27"><a href="data-transformation-with-dplyr.html#cb200-27"></a><span class="co">## 1     1     1</span></span>
<span id="cb200-28"><a href="data-transformation-with-dplyr.html#cb200-28"></a><span class="co">## 2     2     2</span></span>
<span id="cb200-29"><a href="data-transformation-with-dplyr.html#cb200-29"></a></span>
<span id="cb200-30"><a href="data-transformation-with-dplyr.html#cb200-30"></a><span class="co"># if we want to include the row where the value of y is NA</span></span>
<span id="cb200-31"><a href="data-transformation-with-dplyr.html#cb200-31"></a><span class="co"># recall that | means &quot;or&quot;</span></span>
<span id="cb200-32"><a href="data-transformation-with-dplyr.html#cb200-32"></a>data[<span class="kw">which</span>(data<span class="op">$</span>y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(data<span class="op">$</span>y)), ]</span>
<span id="cb200-33"><a href="data-transformation-with-dplyr.html#cb200-33"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb200-34"><a href="data-transformation-with-dplyr.html#cb200-34"></a><span class="co">##       x     y</span></span>
<span id="cb200-35"><a href="data-transformation-with-dplyr.html#cb200-35"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb200-36"><a href="data-transformation-with-dplyr.html#cb200-36"></a><span class="co">## 1     1     1</span></span>
<span id="cb200-37"><a href="data-transformation-with-dplyr.html#cb200-37"></a><span class="co">## 2     2     2</span></span>
<span id="cb200-38"><a href="data-transformation-with-dplyr.html#cb200-38"></a><span class="co">## 3     3    NA</span></span>
<span id="cb200-39"><a href="data-transformation-with-dplyr.html#cb200-39"></a></span>
<span id="cb200-40"><a href="data-transformation-with-dplyr.html#cb200-40"></a><span class="co"># using filter</span></span>
<span id="cb200-41"><a href="data-transformation-with-dplyr.html#cb200-41"></a><span class="kw">filter</span>(data, y <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(y)) </span>
<span id="cb200-42"><a href="data-transformation-with-dplyr.html#cb200-42"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb200-43"><a href="data-transformation-with-dplyr.html#cb200-43"></a><span class="co">##       x     y</span></span>
<span id="cb200-44"><a href="data-transformation-with-dplyr.html#cb200-44"></a><span class="co">##   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb200-45"><a href="data-transformation-with-dplyr.html#cb200-45"></a><span class="co">## 1     1     1</span></span>
<span id="cb200-46"><a href="data-transformation-with-dplyr.html#cb200-46"></a><span class="co">## 2     2     2</span></span>
<span id="cb200-47"><a href="data-transformation-with-dplyr.html#cb200-47"></a><span class="co">## 3     3    NA</span></span></code></pre></div>
<!-- ```{r} -->
<!-- # to find out how many NA values in the column "arr_delay" in the tibble "delay1" -->
<!-- sum(is.na(delay1$arr_delay)) # 0, no flights with arr_delay = NA are selected -->
<!-- # to find out how many NA values in the column "arr_delay" in the tibble "delay2" -->
<!-- sum(is.na(delay2$arr_delay)) # 9304 flights with arr_delay = NA are selected -->
<!-- ``` -->
<p>If you want to drop the NA values with base subsetting<code>[]</code>, you may use</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="data-transformation-with-dplyr.html#cb201-1"></a>delay3 &lt;-<span class="st"> </span>flights[<span class="kw">which</span>((flights<span class="op">$</span>arr_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span> <span class="op">&amp;</span><span class="st"> </span>flights<span class="op">$</span>dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">120</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>), ]</span></code></pre></div>
<p>To see if <code>delay1</code> and <code>delay3</code> are exactly the same:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="data-transformation-with-dplyr.html#cb202-1"></a><span class="kw">identical</span>(delay1, delay3) <span class="co"># TRUE means exactly the same</span></span>
<span id="cb202-2"><a href="data-transformation-with-dplyr.html#cb202-2"></a><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>At this point, you should see that <code>filter</code> could perform the same tasks with simpler code.</p>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Exercises</h3>
<p>1a. Find all flights that had an arrival delay of two or more hours (drop the rows with <code>NA</code> in <code>arr_delay</code>).</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="data-transformation-with-dplyr.html#cb203-1"></a><span class="co"># Using &quot;filter&quot;</span></span>
<span id="cb203-2"><a href="data-transformation-with-dplyr.html#cb203-2"></a><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">120</span>)</span>
<span id="cb203-3"><a href="data-transformation-with-dplyr.html#cb203-3"></a></span>
<span id="cb203-4"><a href="data-transformation-with-dplyr.html#cb203-4"></a><span class="co"># Without using &quot;filter&quot;</span></span>
<span id="cb203-5"><a href="data-transformation-with-dplyr.html#cb203-5"></a>flights[<span class="kw">which</span>(flights<span class="op">$</span>arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">120</span>), ] </span></code></pre></div>
<p>1b. Find all flights that flew to Houston (IAH or HOU).</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="data-transformation-with-dplyr.html#cb204-1"></a><span class="co"># Using &quot;filter&quot;</span></span>
<span id="cb204-2"><a href="data-transformation-with-dplyr.html#cb204-2"></a><span class="kw">filter</span>(flights, dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;IAH&quot;</span>, <span class="st">&quot;HOU&quot;</span>))</span>
<span id="cb204-3"><a href="data-transformation-with-dplyr.html#cb204-3"></a></span>
<span id="cb204-4"><a href="data-transformation-with-dplyr.html#cb204-4"></a><span class="co"># Without using &quot;filter&quot;</span></span>
<span id="cb204-5"><a href="data-transformation-with-dplyr.html#cb204-5"></a>flights[<span class="kw">which</span>(flights<span class="op">$</span>dest <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;IAH&quot;</span>, <span class="st">&quot;HOU&quot;</span>)), ]</span></code></pre></div>
<p>1c. Find all flights that were operated by United, American, or Delta</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="data-transformation-with-dplyr.html#cb205-1"></a><span class="co"># find all the sorted carrier codes in the dataset</span></span>
<span id="cb205-2"><a href="data-transformation-with-dplyr.html#cb205-2"></a><span class="kw">sort</span>(<span class="kw">unique</span>(flights<span class="op">$</span>carrier)) </span>
<span id="cb205-3"><a href="data-transformation-with-dplyr.html#cb205-3"></a><span class="co">##  [1] &quot;9E&quot; &quot;AA&quot; &quot;AS&quot; &quot;B6&quot; &quot;DL&quot; &quot;EV&quot; &quot;F9&quot; &quot;FL&quot; &quot;HA&quot; &quot;MQ&quot; &quot;OO&quot; &quot;UA&quot; &quot;US&quot; &quot;VX&quot; &quot;WN&quot; &quot;YV&quot;</span></span>
<span id="cb205-4"><a href="data-transformation-with-dplyr.html#cb205-4"></a></span>
<span id="cb205-5"><a href="data-transformation-with-dplyr.html#cb205-5"></a><span class="co"># look up airline names from their carrier codes</span></span>
<span id="cb205-6"><a href="data-transformation-with-dplyr.html#cb205-6"></a>airlines </span>
<span id="cb205-7"><a href="data-transformation-with-dplyr.html#cb205-7"></a><span class="co">## # A tibble: 16 x 2</span></span>
<span id="cb205-8"><a href="data-transformation-with-dplyr.html#cb205-8"></a><span class="co">##    carrier name                       </span></span>
<span id="cb205-9"><a href="data-transformation-with-dplyr.html#cb205-9"></a><span class="co">##    &lt;chr&gt;   &lt;chr&gt;                      </span></span>
<span id="cb205-10"><a href="data-transformation-with-dplyr.html#cb205-10"></a><span class="co">##  1 9E      Endeavor Air Inc.          </span></span>
<span id="cb205-11"><a href="data-transformation-with-dplyr.html#cb205-11"></a><span class="co">##  2 AA      American Airlines Inc.     </span></span>
<span id="cb205-12"><a href="data-transformation-with-dplyr.html#cb205-12"></a><span class="co">##  3 AS      Alaska Airlines Inc.       </span></span>
<span id="cb205-13"><a href="data-transformation-with-dplyr.html#cb205-13"></a><span class="co">##  4 B6      JetBlue Airways            </span></span>
<span id="cb205-14"><a href="data-transformation-with-dplyr.html#cb205-14"></a><span class="co">##  5 DL      Delta Air Lines Inc.       </span></span>
<span id="cb205-15"><a href="data-transformation-with-dplyr.html#cb205-15"></a><span class="co">##  6 EV      ExpressJet Airlines Inc.   </span></span>
<span id="cb205-16"><a href="data-transformation-with-dplyr.html#cb205-16"></a><span class="co">##  7 F9      Frontier Airlines Inc.     </span></span>
<span id="cb205-17"><a href="data-transformation-with-dplyr.html#cb205-17"></a><span class="co">##  8 FL      AirTran Airways Corporation</span></span>
<span id="cb205-18"><a href="data-transformation-with-dplyr.html#cb205-18"></a><span class="co">##  9 HA      Hawaiian Airlines Inc.     </span></span>
<span id="cb205-19"><a href="data-transformation-with-dplyr.html#cb205-19"></a><span class="co">## 10 MQ      Envoy Air                  </span></span>
<span id="cb205-20"><a href="data-transformation-with-dplyr.html#cb205-20"></a><span class="co">## 11 OO      SkyWest Airlines Inc.      </span></span>
<span id="cb205-21"><a href="data-transformation-with-dplyr.html#cb205-21"></a><span class="co">## 12 UA      United Air Lines Inc.      </span></span>
<span id="cb205-22"><a href="data-transformation-with-dplyr.html#cb205-22"></a><span class="co">## 13 US      US Airways Inc.            </span></span>
<span id="cb205-23"><a href="data-transformation-with-dplyr.html#cb205-23"></a><span class="co">## 14 VX      Virgin America             </span></span>
<span id="cb205-24"><a href="data-transformation-with-dplyr.html#cb205-24"></a><span class="co">## 15 WN      Southwest Airlines Co.     </span></span>
<span id="cb205-25"><a href="data-transformation-with-dplyr.html#cb205-25"></a><span class="co">## 16 YV      Mesa Airlines Inc.</span></span>
<span id="cb205-26"><a href="data-transformation-with-dplyr.html#cb205-26"></a></span>
<span id="cb205-27"><a href="data-transformation-with-dplyr.html#cb205-27"></a><span class="co"># after looking up the names, we know UA = United, AA = American, DL = Delta</span></span>
<span id="cb205-28"><a href="data-transformation-with-dplyr.html#cb205-28"></a><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;UA&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="st">&quot;DL&quot;</span>))</span>
<span id="cb205-29"><a href="data-transformation-with-dplyr.html#cb205-29"></a><span class="co">## # A tibble: 139,504 x 19</span></span>
<span id="cb205-30"><a href="data-transformation-with-dplyr.html#cb205-30"></a><span class="co">##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier</span></span>
<span id="cb205-31"><a href="data-transformation-with-dplyr.html#cb205-31"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb205-32"><a href="data-transformation-with-dplyr.html#cb205-32"></a><span class="co">##  1  2013     1     1      517            515         2      830            819        11 UA     </span></span>
<span id="cb205-33"><a href="data-transformation-with-dplyr.html#cb205-33"></a><span class="co">##  2  2013     1     1      533            529         4      850            830        20 UA     </span></span>
<span id="cb205-34"><a href="data-transformation-with-dplyr.html#cb205-34"></a><span class="co">##  3  2013     1     1      542            540         2      923            850        33 AA     </span></span>
<span id="cb205-35"><a href="data-transformation-with-dplyr.html#cb205-35"></a><span class="co">##  4  2013     1     1      554            600        -6      812            837       -25 DL     </span></span>
<span id="cb205-36"><a href="data-transformation-with-dplyr.html#cb205-36"></a><span class="co">##  5  2013     1     1      554            558        -4      740            728        12 UA     </span></span>
<span id="cb205-37"><a href="data-transformation-with-dplyr.html#cb205-37"></a><span class="co">##  6  2013     1     1      558            600        -2      753            745         8 AA     </span></span>
<span id="cb205-38"><a href="data-transformation-with-dplyr.html#cb205-38"></a><span class="co">##  7  2013     1     1      558            600        -2      924            917         7 UA     </span></span>
<span id="cb205-39"><a href="data-transformation-with-dplyr.html#cb205-39"></a><span class="co">##  8  2013     1     1      558            600        -2      923            937       -14 UA     </span></span>
<span id="cb205-40"><a href="data-transformation-with-dplyr.html#cb205-40"></a><span class="co">##  9  2013     1     1      559            600        -1      941            910        31 AA     </span></span>
<span id="cb205-41"><a href="data-transformation-with-dplyr.html#cb205-41"></a><span class="co">## 10  2013     1     1      559            600        -1      854            902        -8 UA     </span></span>
<span id="cb205-42"><a href="data-transformation-with-dplyr.html#cb205-42"></a><span class="co">## # ... with 139,494 more rows, and 9 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb205-43"><a href="data-transformation-with-dplyr.html#cb205-43"></a><span class="co">## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code></pre></div>
<p>1d. Find all flights that departed in summer (July, August, and September)</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="data-transformation-with-dplyr.html#cb206-1"></a><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>))</span>
<span id="cb206-2"><a href="data-transformation-with-dplyr.html#cb206-2"></a></span>
<span id="cb206-3"><a href="data-transformation-with-dplyr.html#cb206-3"></a><span class="co"># Alternative Method</span></span>
<span id="cb206-4"><a href="data-transformation-with-dplyr.html#cb206-4"></a><span class="kw">filter</span>(flights, <span class="kw">between</span>(month, <span class="dv">7</span>, <span class="dv">9</span>)) </span></code></pre></div>
<p>1e. Find all flights that arrived more than two hours late, but didn’t leave late</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="data-transformation-with-dplyr.html#cb207-1"></a><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<p>The next two exercises are trickier.</p>
<p><strong>1f</strong>. Find all flights that were delayed by at least an hour, but made up over 30 minutes in flight. First, the flight was delayed by at least an hour is the same as <code>dep_delay &gt;=60</code>. Second, if a flight made up over 30 minutes in flight, the arrival delay must be at least 30 minutes less than the departure delay, which is the same as <code>dep_delay - arr_delay &gt; 30</code>.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="data-transformation-with-dplyr.html#cb208-1"></a><span class="kw">filter</span>(flights, dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">60</span>, dep_delay <span class="op">-</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span>)</span></code></pre></div>
<p><strong>1g</strong>. Find all flights that departed between midnight and 6 a.m. (inclusive).
The first question that should come to your mind is how is <strong>midnight</strong> represented in the dataset? Let’s take a look at <code>summary(flights$dep_time)</code>.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="data-transformation-with-dplyr.html#cb209-1"></a><span class="kw">summary</span>(flights<span class="op">$</span>dep_time)</span>
<span id="cb209-2"><a href="data-transformation-with-dplyr.html#cb209-2"></a><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s </span></span>
<span id="cb209-3"><a href="data-transformation-with-dplyr.html#cb209-3"></a><span class="co">##       1     907    1401    1349    1744    2400    8255</span></span></code></pre></div>
<p>The minimum is <code>1</code> and the maximum is <code>2400</code>. Therefore, you know <strong>midnight</strong> is represented by <code>2400</code> instead of <code>0</code> in this dataset. The answer to the question would be</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="data-transformation-with-dplyr.html#cb210-1"></a><span class="kw">filter</span>(flights, dep_time <span class="op">&lt;=</span><span class="st"> </span><span class="dv">600</span> <span class="op">|</span><span class="st"> </span>dep_time <span class="op">==</span><span class="st"> </span><span class="dv">2400</span>)</span></code></pre></div>
</div>
</div>
<div id="select" class="section level2">
<h2><span class="header-section-number">7.4</span> <code>select()</code></h2>
<p>Very often, we are only interested in some variables in a dataset. In that case, we can focus on the variables by creating a new dataset with those variables only. <strong><code>select()</code> is to select the columns in a dataset by the name of the columns</strong></p>
<p><strong>Selecting Variables</strong></p>
<p>Suppose you want to select the following <span class="math inline">\(3\)</span> columns in <code>flights</code>: <code>year</code>, <code>month</code>, <code>day</code>:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="data-transformation-with-dplyr.html#cb211-1"></a><span class="kw">select</span>(flights, year, month, day)</span>
<span id="cb211-2"><a href="data-transformation-with-dplyr.html#cb211-2"></a><span class="co">## # A tibble: 336,776 x 3</span></span>
<span id="cb211-3"><a href="data-transformation-with-dplyr.html#cb211-3"></a><span class="co">##     year month   day</span></span>
<span id="cb211-4"><a href="data-transformation-with-dplyr.html#cb211-4"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb211-5"><a href="data-transformation-with-dplyr.html#cb211-5"></a><span class="co">##  1  2013     1     1</span></span>
<span id="cb211-6"><a href="data-transformation-with-dplyr.html#cb211-6"></a><span class="co">##  2  2013     1     1</span></span>
<span id="cb211-7"><a href="data-transformation-with-dplyr.html#cb211-7"></a><span class="co">##  3  2013     1     1</span></span>
<span id="cb211-8"><a href="data-transformation-with-dplyr.html#cb211-8"></a><span class="co">##  4  2013     1     1</span></span>
<span id="cb211-9"><a href="data-transformation-with-dplyr.html#cb211-9"></a><span class="co">##  5  2013     1     1</span></span>
<span id="cb211-10"><a href="data-transformation-with-dplyr.html#cb211-10"></a><span class="co">##  6  2013     1     1</span></span>
<span id="cb211-11"><a href="data-transformation-with-dplyr.html#cb211-11"></a><span class="co">##  7  2013     1     1</span></span>
<span id="cb211-12"><a href="data-transformation-with-dplyr.html#cb211-12"></a><span class="co">##  8  2013     1     1</span></span>
<span id="cb211-13"><a href="data-transformation-with-dplyr.html#cb211-13"></a><span class="co">##  9  2013     1     1</span></span>
<span id="cb211-14"><a href="data-transformation-with-dplyr.html#cb211-14"></a><span class="co">## 10  2013     1     1</span></span>
<span id="cb211-15"><a href="data-transformation-with-dplyr.html#cb211-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>The usual way without using <code>select()</code> is</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="data-transformation-with-dplyr.html#cb212-1"></a>flights[<span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>)] <span class="co"># or flights[, c(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;)]</span></span>
<span id="cb212-2"><a href="data-transformation-with-dplyr.html#cb212-2"></a><span class="co">## # A tibble: 336,776 x 3</span></span>
<span id="cb212-3"><a href="data-transformation-with-dplyr.html#cb212-3"></a><span class="co">##     year month   day</span></span>
<span id="cb212-4"><a href="data-transformation-with-dplyr.html#cb212-4"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb212-5"><a href="data-transformation-with-dplyr.html#cb212-5"></a><span class="co">##  1  2013     1     1</span></span>
<span id="cb212-6"><a href="data-transformation-with-dplyr.html#cb212-6"></a><span class="co">##  2  2013     1     1</span></span>
<span id="cb212-7"><a href="data-transformation-with-dplyr.html#cb212-7"></a><span class="co">##  3  2013     1     1</span></span>
<span id="cb212-8"><a href="data-transformation-with-dplyr.html#cb212-8"></a><span class="co">##  4  2013     1     1</span></span>
<span id="cb212-9"><a href="data-transformation-with-dplyr.html#cb212-9"></a><span class="co">##  5  2013     1     1</span></span>
<span id="cb212-10"><a href="data-transformation-with-dplyr.html#cb212-10"></a><span class="co">##  6  2013     1     1</span></span>
<span id="cb212-11"><a href="data-transformation-with-dplyr.html#cb212-11"></a><span class="co">##  7  2013     1     1</span></span>
<span id="cb212-12"><a href="data-transformation-with-dplyr.html#cb212-12"></a><span class="co">##  8  2013     1     1</span></span>
<span id="cb212-13"><a href="data-transformation-with-dplyr.html#cb212-13"></a><span class="co">##  9  2013     1     1</span></span>
<span id="cb212-14"><a href="data-transformation-with-dplyr.html#cb212-14"></a><span class="co">## 10  2013     1     1</span></span>
<span id="cb212-15"><a href="data-transformation-with-dplyr.html#cb212-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Select all columns <strong>between</strong> <code>year</code> and <code>day</code> (inclusive)</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="data-transformation-with-dplyr.html#cb213-1"></a><span class="kw">select</span>(flights, year<span class="op">:</span>day)</span>
<span id="cb213-2"><a href="data-transformation-with-dplyr.html#cb213-2"></a><span class="co">## # A tibble: 336,776 x 3</span></span>
<span id="cb213-3"><a href="data-transformation-with-dplyr.html#cb213-3"></a><span class="co">##     year month   day</span></span>
<span id="cb213-4"><a href="data-transformation-with-dplyr.html#cb213-4"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;</span></span>
<span id="cb213-5"><a href="data-transformation-with-dplyr.html#cb213-5"></a><span class="co">##  1  2013     1     1</span></span>
<span id="cb213-6"><a href="data-transformation-with-dplyr.html#cb213-6"></a><span class="co">##  2  2013     1     1</span></span>
<span id="cb213-7"><a href="data-transformation-with-dplyr.html#cb213-7"></a><span class="co">##  3  2013     1     1</span></span>
<span id="cb213-8"><a href="data-transformation-with-dplyr.html#cb213-8"></a><span class="co">##  4  2013     1     1</span></span>
<span id="cb213-9"><a href="data-transformation-with-dplyr.html#cb213-9"></a><span class="co">##  5  2013     1     1</span></span>
<span id="cb213-10"><a href="data-transformation-with-dplyr.html#cb213-10"></a><span class="co">##  6  2013     1     1</span></span>
<span id="cb213-11"><a href="data-transformation-with-dplyr.html#cb213-11"></a><span class="co">##  7  2013     1     1</span></span>
<span id="cb213-12"><a href="data-transformation-with-dplyr.html#cb213-12"></a><span class="co">##  8  2013     1     1</span></span>
<span id="cb213-13"><a href="data-transformation-with-dplyr.html#cb213-13"></a><span class="co">##  9  2013     1     1</span></span>
<span id="cb213-14"><a href="data-transformation-with-dplyr.html#cb213-14"></a><span class="co">## 10  2013     1     1</span></span>
<span id="cb213-15"><a href="data-transformation-with-dplyr.html#cb213-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p><strong>Excluding Variables</strong></p>
<p>Select all columns except those from year to day (inclusive)</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="data-transformation-with-dplyr.html#cb214-1"></a><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</span>
<span id="cb214-2"><a href="data-transformation-with-dplyr.html#cb214-2"></a></span>
<span id="cb214-3"><a href="data-transformation-with-dplyr.html#cb214-3"></a><span class="kw">select</span>(flights, <span class="op">-</span>year, <span class="op">-</span>month, <span class="op">-</span>day)</span></code></pre></div>
<p>Without using <code>select()</code></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="data-transformation-with-dplyr.html#cb215-1"></a>flights[, <span class="op">!</span>(<span class="kw">colnames</span>(flights) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;month&quot;</span>))]</span></code></pre></div>
<div id="exercises-4" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Exercises</h3>
<p>You can also use</p>
<ul>
<li><code>starts_with("abc")</code> matches names that begin with <code>"abc"</code></li>
<li><code>ends_with("xyz")</code> matches names that end with <code>"xyz"</code></li>
<li><code>contains("ijk")</code> mathces names that contain <code>"ijk"</code></li>
</ul>
<p>Ex: select all columns that end with <code>"delay"</code>.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="data-transformation-with-dplyr.html#cb216-1"></a><span class="kw">select</span>(flights, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>))</span>
<span id="cb216-2"><a href="data-transformation-with-dplyr.html#cb216-2"></a><span class="co">## # A tibble: 336,776 x 2</span></span>
<span id="cb216-3"><a href="data-transformation-with-dplyr.html#cb216-3"></a><span class="co">##    dep_delay arr_delay</span></span>
<span id="cb216-4"><a href="data-transformation-with-dplyr.html#cb216-4"></a><span class="co">##        &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb216-5"><a href="data-transformation-with-dplyr.html#cb216-5"></a><span class="co">##  1         2        11</span></span>
<span id="cb216-6"><a href="data-transformation-with-dplyr.html#cb216-6"></a><span class="co">##  2         4        20</span></span>
<span id="cb216-7"><a href="data-transformation-with-dplyr.html#cb216-7"></a><span class="co">##  3         2        33</span></span>
<span id="cb216-8"><a href="data-transformation-with-dplyr.html#cb216-8"></a><span class="co">##  4        -1       -18</span></span>
<span id="cb216-9"><a href="data-transformation-with-dplyr.html#cb216-9"></a><span class="co">##  5        -6       -25</span></span>
<span id="cb216-10"><a href="data-transformation-with-dplyr.html#cb216-10"></a><span class="co">##  6        -4        12</span></span>
<span id="cb216-11"><a href="data-transformation-with-dplyr.html#cb216-11"></a><span class="co">##  7        -5        19</span></span>
<span id="cb216-12"><a href="data-transformation-with-dplyr.html#cb216-12"></a><span class="co">##  8        -3       -14</span></span>
<span id="cb216-13"><a href="data-transformation-with-dplyr.html#cb216-13"></a><span class="co">##  9        -3        -8</span></span>
<span id="cb216-14"><a href="data-transformation-with-dplyr.html#cb216-14"></a><span class="co">## 10        -2         8</span></span>
<span id="cb216-15"><a href="data-transformation-with-dplyr.html#cb216-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Ex: select all columns that start with <code>"a"</code>.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="data-transformation-with-dplyr.html#cb217-1"></a><span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;a&quot;</span>))</span>
<span id="cb217-2"><a href="data-transformation-with-dplyr.html#cb217-2"></a><span class="co">## # A tibble: 336,776 x 3</span></span>
<span id="cb217-3"><a href="data-transformation-with-dplyr.html#cb217-3"></a><span class="co">##    arr_time arr_delay air_time</span></span>
<span id="cb217-4"><a href="data-transformation-with-dplyr.html#cb217-4"></a><span class="co">##       &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span></span>
<span id="cb217-5"><a href="data-transformation-with-dplyr.html#cb217-5"></a><span class="co">##  1      830        11      227</span></span>
<span id="cb217-6"><a href="data-transformation-with-dplyr.html#cb217-6"></a><span class="co">##  2      850        20      227</span></span>
<span id="cb217-7"><a href="data-transformation-with-dplyr.html#cb217-7"></a><span class="co">##  3      923        33      160</span></span>
<span id="cb217-8"><a href="data-transformation-with-dplyr.html#cb217-8"></a><span class="co">##  4     1004       -18      183</span></span>
<span id="cb217-9"><a href="data-transformation-with-dplyr.html#cb217-9"></a><span class="co">##  5      812       -25      116</span></span>
<span id="cb217-10"><a href="data-transformation-with-dplyr.html#cb217-10"></a><span class="co">##  6      740        12      150</span></span>
<span id="cb217-11"><a href="data-transformation-with-dplyr.html#cb217-11"></a><span class="co">##  7      913        19      158</span></span>
<span id="cb217-12"><a href="data-transformation-with-dplyr.html#cb217-12"></a><span class="co">##  8      709       -14       53</span></span>
<span id="cb217-13"><a href="data-transformation-with-dplyr.html#cb217-13"></a><span class="co">##  9      838        -8      140</span></span>
<span id="cb217-14"><a href="data-transformation-with-dplyr.html#cb217-14"></a><span class="co">## 10      753         8      138</span></span>
<span id="cb217-15"><a href="data-transformation-with-dplyr.html#cb217-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Does the result of running the following code surprise you?</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="data-transformation-with-dplyr.html#cb218-1"></a><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))</span>
<span id="cb218-2"><a href="data-transformation-with-dplyr.html#cb218-2"></a><span class="co">## # A tibble: 336,776 x 6</span></span>
<span id="cb218-3"><a href="data-transformation-with-dplyr.html#cb218-3"></a><span class="co">##    dep_time sched_dep_time arr_time sched_arr_time air_time time_hour          </span></span>
<span id="cb218-4"><a href="data-transformation-with-dplyr.html#cb218-4"></a><span class="co">##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt; &lt;dttm&gt;             </span></span>
<span id="cb218-5"><a href="data-transformation-with-dplyr.html#cb218-5"></a><span class="co">##  1      517            515      830            819      227 2013-01-01 05:00:00</span></span>
<span id="cb218-6"><a href="data-transformation-with-dplyr.html#cb218-6"></a><span class="co">##  2      533            529      850            830      227 2013-01-01 05:00:00</span></span>
<span id="cb218-7"><a href="data-transformation-with-dplyr.html#cb218-7"></a><span class="co">##  3      542            540      923            850      160 2013-01-01 05:00:00</span></span>
<span id="cb218-8"><a href="data-transformation-with-dplyr.html#cb218-8"></a><span class="co">##  4      544            545     1004           1022      183 2013-01-01 05:00:00</span></span>
<span id="cb218-9"><a href="data-transformation-with-dplyr.html#cb218-9"></a><span class="co">##  5      554            600      812            837      116 2013-01-01 06:00:00</span></span>
<span id="cb218-10"><a href="data-transformation-with-dplyr.html#cb218-10"></a><span class="co">##  6      554            558      740            728      150 2013-01-01 05:00:00</span></span>
<span id="cb218-11"><a href="data-transformation-with-dplyr.html#cb218-11"></a><span class="co">##  7      555            600      913            854      158 2013-01-01 06:00:00</span></span>
<span id="cb218-12"><a href="data-transformation-with-dplyr.html#cb218-12"></a><span class="co">##  8      557            600      709            723       53 2013-01-01 06:00:00</span></span>
<span id="cb218-13"><a href="data-transformation-with-dplyr.html#cb218-13"></a><span class="co">##  9      557            600      838            846      140 2013-01-01 06:00:00</span></span>
<span id="cb218-14"><a href="data-transformation-with-dplyr.html#cb218-14"></a><span class="co">## 10      558            600      753            745      138 2013-01-01 06:00:00</span></span>
<span id="cb218-15"><a href="data-transformation-with-dplyr.html#cb218-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Yes, because we used “TIME” but not “time” and still get the selected columns. If you check <code>?contains</code>, you can see that the default is to ignore the case. To change the default:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="data-transformation-with-dplyr.html#cb219-1"></a><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>))</span>
<span id="cb219-2"><a href="data-transformation-with-dplyr.html#cb219-2"></a><span class="co">## # A tibble: 336,776 x 0</span></span></code></pre></div>
<p>Ex: without using <code>select()</code>, select all the columns that contain “time”.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="data-transformation-with-dplyr.html#cb220-1"></a>flights[<span class="kw">grep</span>(<span class="st">&quot;time&quot;</span>, <span class="kw">names</span>(flights))]</span>
<span id="cb220-2"><a href="data-transformation-with-dplyr.html#cb220-2"></a><span class="co">## # A tibble: 336,776 x 6</span></span>
<span id="cb220-3"><a href="data-transformation-with-dplyr.html#cb220-3"></a><span class="co">##    dep_time sched_dep_time arr_time sched_arr_time air_time time_hour          </span></span>
<span id="cb220-4"><a href="data-transformation-with-dplyr.html#cb220-4"></a><span class="co">##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt; &lt;dttm&gt;             </span></span>
<span id="cb220-5"><a href="data-transformation-with-dplyr.html#cb220-5"></a><span class="co">##  1      517            515      830            819      227 2013-01-01 05:00:00</span></span>
<span id="cb220-6"><a href="data-transformation-with-dplyr.html#cb220-6"></a><span class="co">##  2      533            529      850            830      227 2013-01-01 05:00:00</span></span>
<span id="cb220-7"><a href="data-transformation-with-dplyr.html#cb220-7"></a><span class="co">##  3      542            540      923            850      160 2013-01-01 05:00:00</span></span>
<span id="cb220-8"><a href="data-transformation-with-dplyr.html#cb220-8"></a><span class="co">##  4      544            545     1004           1022      183 2013-01-01 05:00:00</span></span>
<span id="cb220-9"><a href="data-transformation-with-dplyr.html#cb220-9"></a><span class="co">##  5      554            600      812            837      116 2013-01-01 06:00:00</span></span>
<span id="cb220-10"><a href="data-transformation-with-dplyr.html#cb220-10"></a><span class="co">##  6      554            558      740            728      150 2013-01-01 05:00:00</span></span>
<span id="cb220-11"><a href="data-transformation-with-dplyr.html#cb220-11"></a><span class="co">##  7      555            600      913            854      158 2013-01-01 06:00:00</span></span>
<span id="cb220-12"><a href="data-transformation-with-dplyr.html#cb220-12"></a><span class="co">##  8      557            600      709            723       53 2013-01-01 06:00:00</span></span>
<span id="cb220-13"><a href="data-transformation-with-dplyr.html#cb220-13"></a><span class="co">##  9      557            600      838            846      140 2013-01-01 06:00:00</span></span>
<span id="cb220-14"><a href="data-transformation-with-dplyr.html#cb220-14"></a><span class="co">## 10      558            600      753            745      138 2013-01-01 06:00:00</span></span>
<span id="cb220-15"><a href="data-transformation-with-dplyr.html#cb220-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Basic Usage of <code>grep</code>: <code>grep(pattern, x)</code>.</p>
<ul>
<li><code>pattern</code>: character string. e.g., “time”, “delay”, “air”</li>
<li><code>x</code>: a character vector where matches are sought. e.g., the colnames of a dataframe.</li>
<li>Output: a vector of the indices of the elements of <code>x</code> that yielded a match.</li>
</ul>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="data-transformation-with-dplyr.html#cb221-1"></a>some_names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;bc&quot;</span>, <span class="st">&quot;cd&quot;</span>)</span>
<span id="cb221-2"><a href="data-transformation-with-dplyr.html#cb221-2"></a><span class="kw">grep</span>(<span class="st">&quot;b&quot;</span>, some_names)</span>
<span id="cb221-3"><a href="data-transformation-with-dplyr.html#cb221-3"></a><span class="co">## [1] 1 2</span></span>
<span id="cb221-4"><a href="data-transformation-with-dplyr.html#cb221-4"></a><span class="kw">grep</span>(<span class="st">&quot;d&quot;</span>, some_names)</span>
<span id="cb221-5"><a href="data-transformation-with-dplyr.html#cb221-5"></a><span class="co">## [1] 3</span></span>
<span id="cb221-6"><a href="data-transformation-with-dplyr.html#cb221-6"></a><span class="kw">grep</span>(<span class="st">&quot;e&quot;</span>, some_names)</span>
<span id="cb221-7"><a href="data-transformation-with-dplyr.html#cb221-7"></a><span class="co">## integer(0)</span></span></code></pre></div>
</div>
</div>
<div id="mutate" class="section level2">
<h2><span class="header-section-number">7.5</span> <code>mutate()</code></h2>
<p><strong>Add new variables with <code>mutate()</code></strong></p>
<p>Very often, we want to create a new variable based on existing variables. For example, if we have distance and time, we can compute the speed by distance/time.</p>
<p><code>mutate()</code> always adds new columns at the end of the dataset. Let’s create a narrower dataset so that we can see the result of <code>mutate</code> without use <code>View()</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="data-transformation-with-dplyr.html#cb222-1"></a><span class="co"># create a smaller dataset</span></span>
<span id="cb222-2"><a href="data-transformation-with-dplyr.html#cb222-2"></a>flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, year<span class="op">:</span>day, arr_delay, dep_delay, distance, air_time)</span></code></pre></div>
<p>Now, let’s use <code>mutate()</code> to create a variable called <code>gain</code> (how much time we gain in flight) defined as <code>arr_delay - dep_delay</code> and a variable called <code>speed</code> (miles/hour) defined as <code>distance</code>/<code>air_time * 60</code>.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="data-transformation-with-dplyr.html#cb223-1"></a><span class="kw">mutate</span>(flights_sml, <span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay, <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</span>
<span id="cb223-2"><a href="data-transformation-with-dplyr.html#cb223-2"></a><span class="co">## # A tibble: 336,776 x 9</span></span>
<span id="cb223-3"><a href="data-transformation-with-dplyr.html#cb223-3"></a><span class="co">##     year month   day arr_delay dep_delay distance air_time  gain speed</span></span>
<span id="cb223-4"><a href="data-transformation-with-dplyr.html#cb223-4"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb223-5"><a href="data-transformation-with-dplyr.html#cb223-5"></a><span class="co">##  1  2013     1     1        11         2     1400      227     9  370.</span></span>
<span id="cb223-6"><a href="data-transformation-with-dplyr.html#cb223-6"></a><span class="co">##  2  2013     1     1        20         4     1416      227    16  374.</span></span>
<span id="cb223-7"><a href="data-transformation-with-dplyr.html#cb223-7"></a><span class="co">##  3  2013     1     1        33         2     1089      160    31  408.</span></span>
<span id="cb223-8"><a href="data-transformation-with-dplyr.html#cb223-8"></a><span class="co">##  4  2013     1     1       -18        -1     1576      183   -17  517.</span></span>
<span id="cb223-9"><a href="data-transformation-with-dplyr.html#cb223-9"></a><span class="co">##  5  2013     1     1       -25        -6      762      116   -19  394.</span></span>
<span id="cb223-10"><a href="data-transformation-with-dplyr.html#cb223-10"></a><span class="co">##  6  2013     1     1        12        -4      719      150    16  288.</span></span>
<span id="cb223-11"><a href="data-transformation-with-dplyr.html#cb223-11"></a><span class="co">##  7  2013     1     1        19        -5     1065      158    24  404.</span></span>
<span id="cb223-12"><a href="data-transformation-with-dplyr.html#cb223-12"></a><span class="co">##  8  2013     1     1       -14        -3      229       53   -11  259.</span></span>
<span id="cb223-13"><a href="data-transformation-with-dplyr.html#cb223-13"></a><span class="co">##  9  2013     1     1        -8        -3      944      140    -5  405.</span></span>
<span id="cb223-14"><a href="data-transformation-with-dplyr.html#cb223-14"></a><span class="co">## 10  2013     1     1         8        -2      733      138    10  319.</span></span>
<span id="cb223-15"><a href="data-transformation-with-dplyr.html#cb223-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>To keep the new variables only, use <code>transmute()</code>:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="data-transformation-with-dplyr.html#cb224-1"></a><span class="kw">transmute</span>(flights_sml, <span class="dt">gain =</span> arr_delay <span class="op">-</span><span class="st"> </span>dep_delay, <span class="dt">speed =</span> distance <span class="op">/</span><span class="st">  </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</span>
<span id="cb224-2"><a href="data-transformation-with-dplyr.html#cb224-2"></a><span class="co">## # A tibble: 336,776 x 2</span></span>
<span id="cb224-3"><a href="data-transformation-with-dplyr.html#cb224-3"></a><span class="co">##     gain speed</span></span>
<span id="cb224-4"><a href="data-transformation-with-dplyr.html#cb224-4"></a><span class="co">##    &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb224-5"><a href="data-transformation-with-dplyr.html#cb224-5"></a><span class="co">##  1     9  370.</span></span>
<span id="cb224-6"><a href="data-transformation-with-dplyr.html#cb224-6"></a><span class="co">##  2    16  374.</span></span>
<span id="cb224-7"><a href="data-transformation-with-dplyr.html#cb224-7"></a><span class="co">##  3    31  408.</span></span>
<span id="cb224-8"><a href="data-transformation-with-dplyr.html#cb224-8"></a><span class="co">##  4   -17  517.</span></span>
<span id="cb224-9"><a href="data-transformation-with-dplyr.html#cb224-9"></a><span class="co">##  5   -19  394.</span></span>
<span id="cb224-10"><a href="data-transformation-with-dplyr.html#cb224-10"></a><span class="co">##  6    16  288.</span></span>
<span id="cb224-11"><a href="data-transformation-with-dplyr.html#cb224-11"></a><span class="co">##  7    24  404.</span></span>
<span id="cb224-12"><a href="data-transformation-with-dplyr.html#cb224-12"></a><span class="co">##  8   -11  259.</span></span>
<span id="cb224-13"><a href="data-transformation-with-dplyr.html#cb224-13"></a><span class="co">##  9    -5  405.</span></span>
<span id="cb224-14"><a href="data-transformation-with-dplyr.html#cb224-14"></a><span class="co">## 10    10  319.</span></span>
<span id="cb224-15"><a href="data-transformation-with-dplyr.html#cb224-15"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Without using <code>select</code> and <code>mutate()</code>, one may use</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="data-transformation-with-dplyr.html#cb225-1"></a>flights_sml2 &lt;-<span class="st"> </span>flights[<span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;distance&quot;</span>, <span class="st">&quot;air_time&quot;</span>)]</span>
<span id="cb225-2"><a href="data-transformation-with-dplyr.html#cb225-2"></a></span>
<span id="cb225-3"><a href="data-transformation-with-dplyr.html#cb225-3"></a>flights_sml2<span class="op">$</span>gain &lt;-<span class="st"> </span>flights_sml2<span class="op">$</span>arr_delay <span class="op">-</span><span class="st"> </span>flights_sml2<span class="op">$</span>dep_delay</span>
<span id="cb225-4"><a href="data-transformation-with-dplyr.html#cb225-4"></a></span>
<span id="cb225-5"><a href="data-transformation-with-dplyr.html#cb225-5"></a>flights_sml2<span class="op">$</span>speed &lt;-<span class="st"> </span>flights_sml2<span class="op">$</span>distance <span class="op">/</span><span class="st"> </span>flights_sml2<span class="op">$</span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span></span></code></pre></div>
<div id="exercises-5" class="section level3">
<h3><span class="header-section-number">7.5.1</span> Exercises</h3>
<p>Ex: Currently, <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they are not really continuous numbers. Convert them to a more convenient representation of <strong>number of minutes since midnight</strong>.</p>
<p>Recall that <code>dep_time</code> and <code>sched_dep_time</code> are in HHMM format. For example, 1304 means 1:04pm. The number of minutes since midnight is <span class="math inline">\(13\times 60 + 4 = 784\)</span>. In general, we can use the integer division to find the number of hours since midnight, then multiply by <span class="math inline">\(60\)</span>, and finally add the remainder for the minutes. For example,</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="data-transformation-with-dplyr.html#cb226-1"></a><span class="dv">1304</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="co"># get the number of hours since midnight</span></span>
<span id="cb226-2"><a href="data-transformation-with-dplyr.html#cb226-2"></a><span class="co">## [1] 13</span></span>
<span id="cb226-3"><a href="data-transformation-with-dplyr.html#cb226-3"></a></span>
<span id="cb226-4"><a href="data-transformation-with-dplyr.html#cb226-4"></a><span class="dv">1304</span> <span class="op">%%</span><span class="st"> </span><span class="dv">100</span> <span class="co"># get the remainder</span></span>
<span id="cb226-5"><a href="data-transformation-with-dplyr.html#cb226-5"></a><span class="co">## [1] 4</span></span>
<span id="cb226-6"><a href="data-transformation-with-dplyr.html#cb226-6"></a></span>
<span id="cb226-7"><a href="data-transformation-with-dplyr.html#cb226-7"></a><span class="dv">1304</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span><span class="dv">1304</span> <span class="op">%%</span><span class="st"> </span><span class="dv">100</span> <span class="co"># number of minutes since midnight</span></span>
<span id="cb226-8"><a href="data-transformation-with-dplyr.html#cb226-8"></a><span class="co">## [1] 784</span></span></code></pre></div>
<p>Recall that midnight is represented as <code>2400</code> in the dataset and the number of minutes since midnight should be 0. However, if we use the above method for midnight, we get</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="data-transformation-with-dplyr.html#cb227-1"></a><span class="dv">2400</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span><span class="dv">2400</span> <span class="op">%%</span><span class="st"> </span><span class="dv">100</span> <span class="co"># this is not correct for midnight</span></span>
<span id="cb227-2"><a href="data-transformation-with-dplyr.html#cb227-2"></a><span class="co">## [1] 1440</span></span></code></pre></div>
<p>Therefore, we also have to deal with this case. One possible solution is to do another integer division by 1440 (24x60 = 1440):</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="data-transformation-with-dplyr.html#cb228-1"></a>(<span class="dv">1304</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span><span class="dv">1304</span> <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1440</span> <span class="co"># will not change the result if the time is not midnight</span></span>
<span id="cb228-2"><a href="data-transformation-with-dplyr.html#cb228-2"></a><span class="co">## [1] 784</span></span>
<span id="cb228-3"><a href="data-transformation-with-dplyr.html#cb228-3"></a></span>
<span id="cb228-4"><a href="data-transformation-with-dplyr.html#cb228-4"></a>(<span class="dv">2400</span> <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span><span class="dv">2400</span> <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1440</span> <span class="co"># this is correct for midnight</span></span>
<span id="cb228-5"><a href="data-transformation-with-dplyr.html#cb228-5"></a><span class="co">## [1] 0</span></span></code></pre></div>
<p>Go back to <code>flights</code>:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="data-transformation-with-dplyr.html#cb229-1"></a><span class="co"># let&#39;s keep only the dep_time and sched_dep_time</span></span>
<span id="cb229-2"><a href="data-transformation-with-dplyr.html#cb229-2"></a>flights_time &lt;-<span class="st"> </span><span class="kw">select</span>(flights, dep_time, sched_dep_time)</span>
<span id="cb229-3"><a href="data-transformation-with-dplyr.html#cb229-3"></a></span>
<span id="cb229-4"><a href="data-transformation-with-dplyr.html#cb229-4"></a><span class="kw">mutate</span>(flights_time, <span class="dt">min_dep_time =</span> (dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1440</span>, </span>
<span id="cb229-5"><a href="data-transformation-with-dplyr.html#cb229-5"></a>       <span class="dt">min_sched_dep_time =</span> (sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1440</span>)</span>
<span id="cb229-6"><a href="data-transformation-with-dplyr.html#cb229-6"></a><span class="co">## # A tibble: 336,776 x 4</span></span>
<span id="cb229-7"><a href="data-transformation-with-dplyr.html#cb229-7"></a><span class="co">##    dep_time sched_dep_time min_dep_time min_sched_dep_time</span></span>
<span id="cb229-8"><a href="data-transformation-with-dplyr.html#cb229-8"></a><span class="co">##       &lt;int&gt;          &lt;int&gt;        &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span id="cb229-9"><a href="data-transformation-with-dplyr.html#cb229-9"></a><span class="co">##  1      517            515          317                315</span></span>
<span id="cb229-10"><a href="data-transformation-with-dplyr.html#cb229-10"></a><span class="co">##  2      533            529          333                329</span></span>
<span id="cb229-11"><a href="data-transformation-with-dplyr.html#cb229-11"></a><span class="co">##  3      542            540          342                340</span></span>
<span id="cb229-12"><a href="data-transformation-with-dplyr.html#cb229-12"></a><span class="co">##  4      544            545          344                345</span></span>
<span id="cb229-13"><a href="data-transformation-with-dplyr.html#cb229-13"></a><span class="co">##  5      554            600          354                360</span></span>
<span id="cb229-14"><a href="data-transformation-with-dplyr.html#cb229-14"></a><span class="co">##  6      554            558          354                358</span></span>
<span id="cb229-15"><a href="data-transformation-with-dplyr.html#cb229-15"></a><span class="co">##  7      555            600          355                360</span></span>
<span id="cb229-16"><a href="data-transformation-with-dplyr.html#cb229-16"></a><span class="co">##  8      557            600          357                360</span></span>
<span id="cb229-17"><a href="data-transformation-with-dplyr.html#cb229-17"></a><span class="co">##  9      557            600          357                360</span></span>
<span id="cb229-18"><a href="data-transformation-with-dplyr.html#cb229-18"></a><span class="co">## 10      558            600          358                360</span></span>
<span id="cb229-19"><a href="data-transformation-with-dplyr.html#cb229-19"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>The above code doesn’t look good because we have written the formula to complete the same task twice. We can define a function to do this:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="data-transformation-with-dplyr.html#cb230-1"></a>time_to_minutes &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb230-2"><a href="data-transformation-with-dplyr.html#cb230-2"></a>  (x <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%%</span><span class="st"> </span><span class="dv">1440</span></span>
<span id="cb230-3"><a href="data-transformation-with-dplyr.html#cb230-3"></a>}</span></code></pre></div>
<p>With the function <code>time_to_minutes</code>, we have:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="data-transformation-with-dplyr.html#cb231-1"></a><span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes</span>(dep_time),</span>
<span id="cb231-2"><a href="data-transformation-with-dplyr.html#cb231-2"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes</span>(sched_dep_time))</span></code></pre></div>
<p>If you cannot think of using <code>%% 1440</code> to deal with the midnight cases, we can write:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="data-transformation-with-dplyr.html#cb232-1"></a><span class="co"># ind for indicator approach</span></span>
<span id="cb232-2"><a href="data-transformation-with-dplyr.html#cb232-2"></a>time_to_minutes_ind &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb232-3"><a href="data-transformation-with-dplyr.html#cb232-3"></a>  (x <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span>(x <span class="op">!=</span><span class="st"> </span><span class="dv">2400</span>)</span>
<span id="cb232-4"><a href="data-transformation-with-dplyr.html#cb232-4"></a>}</span>
<span id="cb232-5"><a href="data-transformation-with-dplyr.html#cb232-5"></a></span>
<span id="cb232-6"><a href="data-transformation-with-dplyr.html#cb232-6"></a><span class="co"># Explanation</span></span>
<span id="cb232-7"><a href="data-transformation-with-dplyr.html#cb232-7"></a><span class="co"># if x is 2400, (x!=2400) is FALSE, FALSE times a number y is 0</span></span>
<span id="cb232-8"><a href="data-transformation-with-dplyr.html#cb232-8"></a><span class="co"># if x is not 2400, (x!=2400) is TRUE, TRUE times a number y is y</span></span>
<span id="cb232-9"><a href="data-transformation-with-dplyr.html#cb232-9"></a><span class="co"># because &quot;FALSE=0, TRUE=1&quot;</span></span>
<span id="cb232-10"><a href="data-transformation-with-dplyr.html#cb232-10"></a></span>
<span id="cb232-11"><a href="data-transformation-with-dplyr.html#cb232-11"></a><span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes_ind</span>(dep_time),</span>
<span id="cb232-12"><a href="data-transformation-with-dplyr.html#cb232-12"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes_ind</span>(sched_dep_time))</span></code></pre></div>
<p>An alternative way is to use <code>ifelse</code> (which is a vectorized function).</p>
<p>Usage of <code>ifelse</code>: <code>ifelse(test, yes, no)</code></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="data-transformation-with-dplyr.html#cb233-1"></a>time_to_minutes_ifelse &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb233-2"><a href="data-transformation-with-dplyr.html#cb233-2"></a>  <span class="kw">ifelse</span>(x <span class="op">!=</span><span class="st"> </span><span class="dv">2400</span>, x <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">0</span>)  </span>
<span id="cb233-3"><a href="data-transformation-with-dplyr.html#cb233-3"></a>}</span>
<span id="cb233-4"><a href="data-transformation-with-dplyr.html#cb233-4"></a></span>
<span id="cb233-5"><a href="data-transformation-with-dplyr.html#cb233-5"></a><span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes_ifelse</span>(dep_time),</span>
<span id="cb233-6"><a href="data-transformation-with-dplyr.html#cb233-6"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes_ifelse</span>(sched_dep_time))</span>
<span id="cb233-7"><a href="data-transformation-with-dplyr.html#cb233-7"></a><span class="co">## # A tibble: 336,776 x 21</span></span>
<span id="cb233-8"><a href="data-transformation-with-dplyr.html#cb233-8"></a><span class="co">##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier</span></span>
<span id="cb233-9"><a href="data-transformation-with-dplyr.html#cb233-9"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;  </span></span>
<span id="cb233-10"><a href="data-transformation-with-dplyr.html#cb233-10"></a><span class="co">##  1  2013     1     1      517            515         2      830            819        11 UA     </span></span>
<span id="cb233-11"><a href="data-transformation-with-dplyr.html#cb233-11"></a><span class="co">##  2  2013     1     1      533            529         4      850            830        20 UA     </span></span>
<span id="cb233-12"><a href="data-transformation-with-dplyr.html#cb233-12"></a><span class="co">##  3  2013     1     1      542            540         2      923            850        33 AA     </span></span>
<span id="cb233-13"><a href="data-transformation-with-dplyr.html#cb233-13"></a><span class="co">##  4  2013     1     1      544            545        -1     1004           1022       -18 B6     </span></span>
<span id="cb233-14"><a href="data-transformation-with-dplyr.html#cb233-14"></a><span class="co">##  5  2013     1     1      554            600        -6      812            837       -25 DL     </span></span>
<span id="cb233-15"><a href="data-transformation-with-dplyr.html#cb233-15"></a><span class="co">##  6  2013     1     1      554            558        -4      740            728        12 UA     </span></span>
<span id="cb233-16"><a href="data-transformation-with-dplyr.html#cb233-16"></a><span class="co">##  7  2013     1     1      555            600        -5      913            854        19 B6     </span></span>
<span id="cb233-17"><a href="data-transformation-with-dplyr.html#cb233-17"></a><span class="co">##  8  2013     1     1      557            600        -3      709            723       -14 EV     </span></span>
<span id="cb233-18"><a href="data-transformation-with-dplyr.html#cb233-18"></a><span class="co">##  9  2013     1     1      557            600        -3      838            846        -8 B6     </span></span>
<span id="cb233-19"><a href="data-transformation-with-dplyr.html#cb233-19"></a><span class="co">## 10  2013     1     1      558            600        -2      753            745         8 AA     </span></span>
<span id="cb233-20"><a href="data-transformation-with-dplyr.html#cb233-20"></a><span class="co">## # ... with 336,766 more rows, and 11 more variables: flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span>
<span id="cb233-21"><a href="data-transformation-with-dplyr.html#cb233-21"></a><span class="co">## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span id="cb233-22"><a href="data-transformation-with-dplyr.html#cb233-22"></a><span class="co">## #   min_dep_time &lt;dbl&gt;, min_sched_dep_time &lt;dbl&gt;</span></span></code></pre></div>
<p>A less efficient way with for loop and if-else:</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="data-transformation-with-dplyr.html#cb234-1"></a><span class="co"># if for if-else approach</span></span>
<span id="cb234-2"><a href="data-transformation-with-dplyr.html#cb234-2"></a>time_to_minutes_if &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb234-3"><a href="data-transformation-with-dplyr.html#cb234-3"></a>  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</span>
<span id="cb234-4"><a href="data-transformation-with-dplyr.html#cb234-4"></a>  output &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, n)</span>
<span id="cb234-5"><a href="data-transformation-with-dplyr.html#cb234-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n) {</span>
<span id="cb234-6"><a href="data-transformation-with-dplyr.html#cb234-6"></a>    <span class="cf">if</span> (<span class="kw">is.na</span>(x[i])){ <span class="co"># check for NA</span></span>
<span id="cb234-7"><a href="data-transformation-with-dplyr.html#cb234-7"></a>      output[i] &lt;-<span class="st"> </span><span class="ot">NA</span></span>
<span id="cb234-8"><a href="data-transformation-with-dplyr.html#cb234-8"></a>    } <span class="cf">else</span> <span class="cf">if</span> (x[i] <span class="op">!=</span><span class="st"> </span><span class="dv">2400</span>) { <span class="co"># if not equal to 2400</span></span>
<span id="cb234-9"><a href="data-transformation-with-dplyr.html#cb234-9"></a>      output[i] &lt;-<span class="st"> </span>x[i] <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span> <span class="op">+</span><span class="st"> </span>x[i] <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></span>
<span id="cb234-10"><a href="data-transformation-with-dplyr.html#cb234-10"></a>    } <span class="cf">else</span> { <span class="co"># if equal to 2400</span></span>
<span id="cb234-11"><a href="data-transformation-with-dplyr.html#cb234-11"></a>      output[i] &lt;-<span class="st"> </span><span class="dv">0</span></span>
<span id="cb234-12"><a href="data-transformation-with-dplyr.html#cb234-12"></a>    }</span>
<span id="cb234-13"><a href="data-transformation-with-dplyr.html#cb234-13"></a>  }</span>
<span id="cb234-14"><a href="data-transformation-with-dplyr.html#cb234-14"></a>  <span class="kw">return</span>(output)</span>
<span id="cb234-15"><a href="data-transformation-with-dplyr.html#cb234-15"></a>}</span>
<span id="cb234-16"><a href="data-transformation-with-dplyr.html#cb234-16"></a></span>
<span id="cb234-17"><a href="data-transformation-with-dplyr.html#cb234-17"></a><span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes_if</span>(dep_time),</span>
<span id="cb234-18"><a href="data-transformation-with-dplyr.html#cb234-18"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes_if</span>(sched_dep_time))</span></code></pre></div>
<p>Compare the efficiency:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="data-transformation-with-dplyr.html#cb235-1"></a><span class="kw">system.time</span>(<span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes</span>(dep_time),</span>
<span id="cb235-2"><a href="data-transformation-with-dplyr.html#cb235-2"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes</span>(sched_dep_time)))</span>
<span id="cb235-3"><a href="data-transformation-with-dplyr.html#cb235-3"></a><span class="co">##    user  system elapsed </span></span>
<span id="cb235-4"><a href="data-transformation-with-dplyr.html#cb235-4"></a><span class="co">##    0.05    0.00    0.04</span></span>
<span id="cb235-5"><a href="data-transformation-with-dplyr.html#cb235-5"></a></span>
<span id="cb235-6"><a href="data-transformation-with-dplyr.html#cb235-6"></a><span class="kw">system.time</span>(<span class="kw">mutate</span>(flights, <span class="dt">min_dep_time =</span> <span class="kw">time_to_minutes_if</span>(dep_time),</span>
<span id="cb235-7"><a href="data-transformation-with-dplyr.html#cb235-7"></a>                <span class="dt">min_sched_dep_time =</span> <span class="kw">time_to_minutes_if</span>(sched_dep_time)))</span>
<span id="cb235-8"><a href="data-transformation-with-dplyr.html#cb235-8"></a><span class="co">##    user  system elapsed </span></span>
<span id="cb235-9"><a href="data-transformation-with-dplyr.html#cb235-9"></a><span class="co">##    0.45    0.00    0.46</span></span></code></pre></div>
<!-- 2. Compare `dep_time, sched_dep_time`, and `dep_delay`. How would you expect those three numbers to be related? -->
<!-- ```{r} -->
<!-- x = time_to_minutes(flights$dep_time) -->
<!-- y = time_to_minutes(flights$sched_dep_time) + flights$dep_delay -->
<!-- diff = y-x -->
<!-- mean(na.omit(diff)==0) # we expect it should be 1 -->
<!-- mean(diff==0, na.rm=TRUE) # ignore the NA values when doing the mean -->
<!-- table(diff) # diff only takes 2 values: 0 and 1440 -->
<!-- flights[which(diff==1440)[1],] -->
<!-- # the sched_dep_time is 18:35 -->
<!-- # after delay for 853 minutes -->
<!-- # the dep time becomes the next morning.. -->
<!-- # that's why there is a 1440 difference -->
<!-- ``` -->
</div>
</div>
<div id="summarize-group_by" class="section level2">
<h2><span class="header-section-number">7.6</span> <code>summarize(), group_by()</code></h2>
<p>Average delay over the year (not useful):</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="data-transformation-with-dplyr.html#cb236-1"></a><span class="kw">summarize</span>(flights, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb236-2"><a href="data-transformation-with-dplyr.html#cb236-2"></a><span class="co">## # A tibble: 1 x 1</span></span>
<span id="cb236-3"><a href="data-transformation-with-dplyr.html#cb236-3"></a><span class="co">##   delay</span></span>
<span id="cb236-4"><a href="data-transformation-with-dplyr.html#cb236-4"></a><span class="co">##   &lt;dbl&gt;</span></span>
<span id="cb236-5"><a href="data-transformation-with-dplyr.html#cb236-5"></a><span class="co">## 1  12.6</span></span></code></pre></div>
<p>Using <code>summarize</code> with <code>group_by</code> and <code>ungroup</code> can result in more useful statistics.</p>
<ol style="list-style-type: decimal">
<li>Use <code>group_by</code>. First argument is your dataset. Subsequent arguments indicate how you want to group the data.</li>
<li>In <code>summarize</code>, the dataset becomes the dataset from <code>group_by</code>.</li>
<li>After performing the calculation using <code>summarize</code>, use <code>ungroup</code>. If you do not use <code>ungroup</code> after <code>group_by</code>, the grouping structure is still retained in the object that you create and the subsequent calculation may yield something that you do not expect.</li>
</ol>
<p>E.g.: Average departure delay per date (more useful):</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="data-transformation-with-dplyr.html#cb237-1"></a>by_day &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)</span>
<span id="cb237-2"><a href="data-transformation-with-dplyr.html#cb237-2"></a>mean_delay &lt;-<span class="st"> </span><span class="kw">summarize</span>(by_day, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb237-3"><a href="data-transformation-with-dplyr.html#cb237-3"></a><span class="co">## `summarise()` has grouped output by &#39;year&#39;, &#39;month&#39;. You can override using the `.groups` argument.</span></span>
<span id="cb237-4"><a href="data-transformation-with-dplyr.html#cb237-4"></a>(mean_delay &lt;-<span class="st"> </span><span class="kw">ungroup</span>(mean_delay)) <span class="co"># use ungroup() after gropu_by()</span></span>
<span id="cb237-5"><a href="data-transformation-with-dplyr.html#cb237-5"></a><span class="co">## # A tibble: 365 x 4</span></span>
<span id="cb237-6"><a href="data-transformation-with-dplyr.html#cb237-6"></a><span class="co">##     year month   day delay</span></span>
<span id="cb237-7"><a href="data-transformation-with-dplyr.html#cb237-7"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb237-8"><a href="data-transformation-with-dplyr.html#cb237-8"></a><span class="co">##  1  2013     1     1 11.5 </span></span>
<span id="cb237-9"><a href="data-transformation-with-dplyr.html#cb237-9"></a><span class="co">##  2  2013     1     2 13.9 </span></span>
<span id="cb237-10"><a href="data-transformation-with-dplyr.html#cb237-10"></a><span class="co">##  3  2013     1     3 11.0 </span></span>
<span id="cb237-11"><a href="data-transformation-with-dplyr.html#cb237-11"></a><span class="co">##  4  2013     1     4  8.95</span></span>
<span id="cb237-12"><a href="data-transformation-with-dplyr.html#cb237-12"></a><span class="co">##  5  2013     1     5  5.73</span></span>
<span id="cb237-13"><a href="data-transformation-with-dplyr.html#cb237-13"></a><span class="co">##  6  2013     1     6  7.15</span></span>
<span id="cb237-14"><a href="data-transformation-with-dplyr.html#cb237-14"></a><span class="co">##  7  2013     1     7  5.42</span></span>
<span id="cb237-15"><a href="data-transformation-with-dplyr.html#cb237-15"></a><span class="co">##  8  2013     1     8  2.55</span></span>
<span id="cb237-16"><a href="data-transformation-with-dplyr.html#cb237-16"></a><span class="co">##  9  2013     1     9  2.28</span></span>
<span id="cb237-17"><a href="data-transformation-with-dplyr.html#cb237-17"></a><span class="co">## 10  2013     1    10  2.84</span></span>
<span id="cb237-18"><a href="data-transformation-with-dplyr.html#cb237-18"></a><span class="co">## # ... with 355 more rows</span></span></code></pre></div>
</div>
<div id="combining-multiple-operations-with-pipe" class="section level2">
<h2><span class="header-section-number">7.7</span> Combining Multiple Operations with Pipe <code>%&gt;%</code></h2>
<p>You can use the shortcut Ctrl/Cmd + Shift + M to insert the pipe operator <code>%&gt;%</code>.</p>
<p><code>x %&gt;% f(y)</code> turns into <code>f(x, y)</code></p>
<p>For example,</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="data-transformation-with-dplyr.html#cb238-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb238-2"><a href="data-transformation-with-dplyr.html#cb238-2"></a><span class="st">  </span><span class="kw">filter</span>(month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<p>is the same as</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="data-transformation-with-dplyr.html#cb239-1"></a><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</span></code></pre></div>
<p><code>x %&gt;% f(y) %&gt;% g(z)</code> turns into <code>g(f(x, y), z)</code>.</p>
<p>For example,</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="data-transformation-with-dplyr.html#cb240-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-2"><a href="data-transformation-with-dplyr.html#cb240-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-3"><a href="data-transformation-with-dplyr.html#cb240-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb240-4"><a href="data-transformation-with-dplyr.html#cb240-4"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<p>is the same as</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="data-transformation-with-dplyr.html#cb241-1"></a><span class="kw">ungroup</span>(<span class="kw">summarize</span>(<span class="kw">group_by</span>(flights, year, month), <span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span></code></pre></div>
<p>Using the pipe can avoid creating and naming intermediate objects that we don’t need. Instead, the pipe focuses on the sequence of actions, not the object that the actions being performed on. It also tends to make the code easier to read. For the above example, you can read it as: for the dataset flights, we first group the data by <code>year</code> and <code>month</code>, then summarize the data by finding the mean. We can think of the pipe <code>%&gt;%</code> as “then”.</p>
<p>Pipe <code>%&gt;%</code> can also be used with <code>ggplot</code>:</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="data-transformation-with-dplyr.html#cb242-1"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-2"><a href="data-transformation-with-dplyr.html#cb242-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-3"><a href="data-transformation-with-dplyr.html#cb242-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mean_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-4"><a href="data-transformation-with-dplyr.html#cb242-4"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb242-5"><a href="data-transformation-with-dplyr.html#cb242-5"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(month), <span class="dt">y =</span> mean_dep_delay)) <span class="op">+</span></span>
<span id="cb242-6"><a href="data-transformation-with-dplyr.html#cb242-6"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="co"># notice the spacing for good indentation</span></span></code></pre></div>
<p><img src="Book_files/figure-html/unnamed-chunk-256-1.png" width="75%" style="display: block; margin: auto;" /></p>
<p>Notice the difference between <code>%&gt;%</code> and <code>+</code> in the above code.</p>
<p>E.g. Create new columns for the average departure delay by date and average departure delay by destination using <code>mutate</code></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="data-transformation-with-dplyr.html#cb243-1"></a>group_date &lt;-<span class="st"> </span><span class="kw">group_by</span>(<span class="kw">select</span>(flights, year<span class="op">:</span>day, dep_delay, dest), month, day)</span>
<span id="cb243-2"><a href="data-transformation-with-dplyr.html#cb243-2"></a>flights2 &lt;-<span class="st"> </span><span class="kw">mutate</span>(group_date, <span class="dt">avg_date_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</span>
<span id="cb243-3"><a href="data-transformation-with-dplyr.html#cb243-3"></a>group_dest &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights2, dest)</span>
<span id="cb243-4"><a href="data-transformation-with-dplyr.html#cb243-4"></a>(flights3 &lt;-<span class="st"> </span><span class="kw">ungroup</span>(<span class="kw">mutate</span>(group_dest, <span class="dt">avg_dest_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))))</span>
<span id="cb243-5"><a href="data-transformation-with-dplyr.html#cb243-5"></a><span class="co">## # A tibble: 336,776 x 7</span></span>
<span id="cb243-6"><a href="data-transformation-with-dplyr.html#cb243-6"></a><span class="co">##     year month   day dep_delay dest  avg_date_dep_delay avg_dest_dep_delay</span></span>
<span id="cb243-7"><a href="data-transformation-with-dplyr.html#cb243-7"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span id="cb243-8"><a href="data-transformation-with-dplyr.html#cb243-8"></a><span class="co">##  1  2013     1     1         2 IAH                 11.5              10.8 </span></span>
<span id="cb243-9"><a href="data-transformation-with-dplyr.html#cb243-9"></a><span class="co">##  2  2013     1     1         4 IAH                 11.5              10.8 </span></span>
<span id="cb243-10"><a href="data-transformation-with-dplyr.html#cb243-10"></a><span class="co">##  3  2013     1     1         2 MIA                 11.5               8.88</span></span>
<span id="cb243-11"><a href="data-transformation-with-dplyr.html#cb243-11"></a><span class="co">##  4  2013     1     1        -1 BQN                 11.5              12.4 </span></span>
<span id="cb243-12"><a href="data-transformation-with-dplyr.html#cb243-12"></a><span class="co">##  5  2013     1     1        -6 ATL                 11.5              12.5 </span></span>
<span id="cb243-13"><a href="data-transformation-with-dplyr.html#cb243-13"></a><span class="co">##  6  2013     1     1        -4 ORD                 11.5              13.6 </span></span>
<span id="cb243-14"><a href="data-transformation-with-dplyr.html#cb243-14"></a><span class="co">##  7  2013     1     1        -5 FLL                 11.5              12.7 </span></span>
<span id="cb243-15"><a href="data-transformation-with-dplyr.html#cb243-15"></a><span class="co">##  8  2013     1     1        -3 IAD                 11.5              17.0 </span></span>
<span id="cb243-16"><a href="data-transformation-with-dplyr.html#cb243-16"></a><span class="co">##  9  2013     1     1        -3 MCO                 11.5              11.3 </span></span>
<span id="cb243-17"><a href="data-transformation-with-dplyr.html#cb243-17"></a><span class="co">## 10  2013     1     1        -2 ORD                 11.5              13.6 </span></span>
<span id="cb243-18"><a href="data-transformation-with-dplyr.html#cb243-18"></a><span class="co">## # ... with 336,766 more rows</span></span>
<span id="cb243-19"><a href="data-transformation-with-dplyr.html#cb243-19"></a></span>
<span id="cb243-20"><a href="data-transformation-with-dplyr.html#cb243-20"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-21"><a href="data-transformation-with-dplyr.html#cb243-21"></a><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dep_delay, dest) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-22"><a href="data-transformation-with-dplyr.html#cb243-22"></a><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-23"><a href="data-transformation-with-dplyr.html#cb243-23"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_date_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-24"><a href="data-transformation-with-dplyr.html#cb243-24"></a><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># By default, group_by() overrides existing grouping</span></span>
<span id="cb243-25"><a href="data-transformation-with-dplyr.html#cb243-25"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_dest_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb243-26"><a href="data-transformation-with-dplyr.html#cb243-26"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb243-27"><a href="data-transformation-with-dplyr.html#cb243-27"></a><span class="co">## # A tibble: 336,776 x 7</span></span>
<span id="cb243-28"><a href="data-transformation-with-dplyr.html#cb243-28"></a><span class="co">##     year month   day dep_delay dest  avg_date_dep_delay avg_dest_dep_delay</span></span>
<span id="cb243-29"><a href="data-transformation-with-dplyr.html#cb243-29"></a><span class="co">##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;              &lt;dbl&gt;</span></span>
<span id="cb243-30"><a href="data-transformation-with-dplyr.html#cb243-30"></a><span class="co">##  1  2013     1     1         2 IAH                 11.5              10.8 </span></span>
<span id="cb243-31"><a href="data-transformation-with-dplyr.html#cb243-31"></a><span class="co">##  2  2013     1     1         4 IAH                 11.5              10.8 </span></span>
<span id="cb243-32"><a href="data-transformation-with-dplyr.html#cb243-32"></a><span class="co">##  3  2013     1     1         2 MIA                 11.5               8.88</span></span>
<span id="cb243-33"><a href="data-transformation-with-dplyr.html#cb243-33"></a><span class="co">##  4  2013     1     1        -1 BQN                 11.5              12.4 </span></span>
<span id="cb243-34"><a href="data-transformation-with-dplyr.html#cb243-34"></a><span class="co">##  5  2013     1     1        -6 ATL                 11.5              12.5 </span></span>
<span id="cb243-35"><a href="data-transformation-with-dplyr.html#cb243-35"></a><span class="co">##  6  2013     1     1        -4 ORD                 11.5              13.6 </span></span>
<span id="cb243-36"><a href="data-transformation-with-dplyr.html#cb243-36"></a><span class="co">##  7  2013     1     1        -5 FLL                 11.5              12.7 </span></span>
<span id="cb243-37"><a href="data-transformation-with-dplyr.html#cb243-37"></a><span class="co">##  8  2013     1     1        -3 IAD                 11.5              17.0 </span></span>
<span id="cb243-38"><a href="data-transformation-with-dplyr.html#cb243-38"></a><span class="co">##  9  2013     1     1        -3 MCO                 11.5              11.3 </span></span>
<span id="cb243-39"><a href="data-transformation-with-dplyr.html#cb243-39"></a><span class="co">## 10  2013     1     1        -2 ORD                 11.5              13.6 </span></span>
<span id="cb243-40"><a href="data-transformation-with-dplyr.html#cb243-40"></a><span class="co">## # ... with 336,766 more rows</span></span></code></pre></div>
<p>Note: if you have to manipulate some intermediate objects, it may make sense not to use the pipe operator in that situation.</p>
<p><strong>More examples:</strong></p>
<p>Average delay per month:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="data-transformation-with-dplyr.html#cb244-1"></a>by_month &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, month)</span>
<span id="cb244-2"><a href="data-transformation-with-dplyr.html#cb244-2"></a><span class="kw">ungroup</span>(<span class="kw">summarize</span>(by_month, <span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb244-3"><a href="data-transformation-with-dplyr.html#cb244-3"></a><span class="co">## # A tibble: 12 x 2</span></span>
<span id="cb244-4"><a href="data-transformation-with-dplyr.html#cb244-4"></a><span class="co">##    month delay</span></span>
<span id="cb244-5"><a href="data-transformation-with-dplyr.html#cb244-5"></a><span class="co">##    &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb244-6"><a href="data-transformation-with-dplyr.html#cb244-6"></a><span class="co">##  1     1 10.0 </span></span>
<span id="cb244-7"><a href="data-transformation-with-dplyr.html#cb244-7"></a><span class="co">##  2     2 10.8 </span></span>
<span id="cb244-8"><a href="data-transformation-with-dplyr.html#cb244-8"></a><span class="co">##  3     3 13.2 </span></span>
<span id="cb244-9"><a href="data-transformation-with-dplyr.html#cb244-9"></a><span class="co">##  4     4 13.9 </span></span>
<span id="cb244-10"><a href="data-transformation-with-dplyr.html#cb244-10"></a><span class="co">##  5     5 13.0 </span></span>
<span id="cb244-11"><a href="data-transformation-with-dplyr.html#cb244-11"></a><span class="co">##  6     6 20.8 </span></span>
<span id="cb244-12"><a href="data-transformation-with-dplyr.html#cb244-12"></a><span class="co">##  7     7 21.7 </span></span>
<span id="cb244-13"><a href="data-transformation-with-dplyr.html#cb244-13"></a><span class="co">##  8     8 12.6 </span></span>
<span id="cb244-14"><a href="data-transformation-with-dplyr.html#cb244-14"></a><span class="co">##  9     9  6.72</span></span>
<span id="cb244-15"><a href="data-transformation-with-dplyr.html#cb244-15"></a><span class="co">## 10    10  6.24</span></span>
<span id="cb244-16"><a href="data-transformation-with-dplyr.html#cb244-16"></a><span class="co">## 11    11  5.44</span></span>
<span id="cb244-17"><a href="data-transformation-with-dplyr.html#cb244-17"></a><span class="co">## 12    12 16.6</span></span>
<span id="cb244-18"><a href="data-transformation-with-dplyr.html#cb244-18"></a></span>
<span id="cb244-19"><a href="data-transformation-with-dplyr.html#cb244-19"></a>flights <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb244-20"><a href="data-transformation-with-dplyr.html#cb244-20"></a><span class="st">  </span><span class="kw">group_by</span>(month) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb244-21"><a href="data-transformation-with-dplyr.html#cb244-21"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb244-22"><a href="data-transformation-with-dplyr.html#cb244-22"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="co"># a good habit is to use ungroup after the calculations</span></span>
<span id="cb244-23"><a href="data-transformation-with-dplyr.html#cb244-23"></a><span class="co">## # A tibble: 12 x 2</span></span>
<span id="cb244-24"><a href="data-transformation-with-dplyr.html#cb244-24"></a><span class="co">##    month delay</span></span>
<span id="cb244-25"><a href="data-transformation-with-dplyr.html#cb244-25"></a><span class="co">##    &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb244-26"><a href="data-transformation-with-dplyr.html#cb244-26"></a><span class="co">##  1     1 10.0 </span></span>
<span id="cb244-27"><a href="data-transformation-with-dplyr.html#cb244-27"></a><span class="co">##  2     2 10.8 </span></span>
<span id="cb244-28"><a href="data-transformation-with-dplyr.html#cb244-28"></a><span class="co">##  3     3 13.2 </span></span>
<span id="cb244-29"><a href="data-transformation-with-dplyr.html#cb244-29"></a><span class="co">##  4     4 13.9 </span></span>
<span id="cb244-30"><a href="data-transformation-with-dplyr.html#cb244-30"></a><span class="co">##  5     5 13.0 </span></span>
<span id="cb244-31"><a href="data-transformation-with-dplyr.html#cb244-31"></a><span class="co">##  6     6 20.8 </span></span>
<span id="cb244-32"><a href="data-transformation-with-dplyr.html#cb244-32"></a><span class="co">##  7     7 21.7 </span></span>
<span id="cb244-33"><a href="data-transformation-with-dplyr.html#cb244-33"></a><span class="co">##  8     8 12.6 </span></span>
<span id="cb244-34"><a href="data-transformation-with-dplyr.html#cb244-34"></a><span class="co">##  9     9  6.72</span></span>
<span id="cb244-35"><a href="data-transformation-with-dplyr.html#cb244-35"></a><span class="co">## 10    10  6.24</span></span>
<span id="cb244-36"><a href="data-transformation-with-dplyr.html#cb244-36"></a><span class="co">## 11    11  5.44</span></span>
<span id="cb244-37"><a href="data-transformation-with-dplyr.html#cb244-37"></a><span class="co">## 12    12 16.6</span></span></code></pre></div>
<p>Ex: Find the average weights of the cars grouped by the number of gears.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="data-transformation-with-dplyr.html#cb245-1"></a>mtcars_gear &lt;-<span class="st"> </span><span class="kw">group_by</span>(mtcars, gear)</span>
<span id="cb245-2"><a href="data-transformation-with-dplyr.html#cb245-2"></a><span class="kw">ungroup</span>(<span class="kw">summarize</span>(mtcars_gear, <span class="dt">avg_wt =</span> <span class="kw">mean</span>(wt, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</span>
<span id="cb245-3"><a href="data-transformation-with-dplyr.html#cb245-3"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb245-4"><a href="data-transformation-with-dplyr.html#cb245-4"></a><span class="co">##    gear avg_wt</span></span>
<span id="cb245-5"><a href="data-transformation-with-dplyr.html#cb245-5"></a><span class="co">##   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb245-6"><a href="data-transformation-with-dplyr.html#cb245-6"></a><span class="co">## 1     3   3.89</span></span>
<span id="cb245-7"><a href="data-transformation-with-dplyr.html#cb245-7"></a><span class="co">## 2     4   2.62</span></span>
<span id="cb245-8"><a href="data-transformation-with-dplyr.html#cb245-8"></a><span class="co">## 3     5   2.63</span></span>
<span id="cb245-9"><a href="data-transformation-with-dplyr.html#cb245-9"></a></span>
<span id="cb245-10"><a href="data-transformation-with-dplyr.html#cb245-10"></a>mtcars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-11"><a href="data-transformation-with-dplyr.html#cb245-11"></a><span class="st">  </span><span class="kw">group_by</span>(gear) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-12"><a href="data-transformation-with-dplyr.html#cb245-12"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">avg_wt =</span> <span class="kw">mean</span>(wt, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb245-13"><a href="data-transformation-with-dplyr.html#cb245-13"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb245-14"><a href="data-transformation-with-dplyr.html#cb245-14"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb245-15"><a href="data-transformation-with-dplyr.html#cb245-15"></a><span class="co">##    gear avg_wt</span></span>
<span id="cb245-16"><a href="data-transformation-with-dplyr.html#cb245-16"></a><span class="co">##   &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb245-17"><a href="data-transformation-with-dplyr.html#cb245-17"></a><span class="co">## 1     3   3.89</span></span>
<span id="cb245-18"><a href="data-transformation-with-dplyr.html#cb245-18"></a><span class="co">## 2     4   2.62</span></span>
<span id="cb245-19"><a href="data-transformation-with-dplyr.html#cb245-19"></a><span class="co">## 3     5   2.63</span></span></code></pre></div>
<p>Ex: Find the sample standard deviation of the weights of the cars grouped by the number of gears.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="data-transformation-with-dplyr.html#cb246-1"></a>mtcars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb246-2"><a href="data-transformation-with-dplyr.html#cb246-2"></a><span class="st">  </span><span class="kw">group_by</span>(gear) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb246-3"><a href="data-transformation-with-dplyr.html#cb246-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">sd_wt =</span> <span class="kw">sd</span>(wt, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb246-4"><a href="data-transformation-with-dplyr.html#cb246-4"></a><span class="st">  </span><span class="kw">ungroup</span>()</span>
<span id="cb246-5"><a href="data-transformation-with-dplyr.html#cb246-5"></a><span class="co">## # A tibble: 3 x 2</span></span>
<span id="cb246-6"><a href="data-transformation-with-dplyr.html#cb246-6"></a><span class="co">##    gear sd_wt</span></span>
<span id="cb246-7"><a href="data-transformation-with-dplyr.html#cb246-7"></a><span class="co">##   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb246-8"><a href="data-transformation-with-dplyr.html#cb246-8"></a><span class="co">## 1     3 0.833</span></span>
<span id="cb246-9"><a href="data-transformation-with-dplyr.html#cb246-9"></a><span class="co">## 2     4 0.633</span></span>
<span id="cb246-10"><a href="data-transformation-with-dplyr.html#cb246-10"></a><span class="co">## 3     5 0.819</span></span></code></pre></div>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">7.8</span> Summary</h2>
<p>Functions and operators learned in this chapter: <code>arrange</code>, <code>filter</code>, <code>identical</code>, <code>%in%</code>, <code>tibble</code>, <code>ifelse</code>, <code>mutate</code>, <code>transmute</code>, <code>select</code>, <code>grep</code>, <code>group_by</code>, <code>summarize</code>, <code>ungroup</code>, <code>%&gt;%</code></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="review-chapter-1-5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-visualization-with-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Book.pdf", "Book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
